function makeAddBox(e,t,n,o,a){let r=document.createElement("p");r.classList.add("flex");let l=document.createElement("span");l.classList.add("fieldEditable"),l.textContent=e,r.appendChild(l);let i=document.createElement("span");i.classList.add("flexrow"),i.dataset._id=t,i.dataset.type=n,i.dataset.values=o,r.appendChild(i);let c=document.createElement("span");c.classList.add("remove","editContol"),c.setAttribute("title","remove this entry"),i.appendChild(c);let s=document.createElement("span");s.classList.add("edit","editContol"),s.setAttribute("title","edit this entry"),i.appendChild(s);let d=document.createElement("span");d.classList.add("save","editContol"),d.setAttribute("title","save this edit"),d.addEventListener("click",(()=>{saveFn(d)})),i.appendChild(d);let u=document.querySelector(a);u.insertBefore(r,u.children[u.childElementCount-1])}function whipe(){document.querySelector(".x").textContent=0,document.querySelector(".y").textContent=0,document.querySelector(".z").textContent=1999,document.querySelector(".itemNewWeight").textContent=0,document.querySelector("#item_type").textContent="",document.querySelector(".nameedit").classList.remove("hide"),document.querySelector("#editmodal-item_type").style.display="block"}function saveNewTheme(e,t){xhr({_id:e,theme:{name:t,"image links":[]}},"/backend/updateArrayItem",(function(e){"success"===e&&alert("hurrah")}))}function saveFn(e){let t=e.parentElement.previousSibling.textContent,n=JSON.parse(e.parentElement.dataset.values),o=e.parentElement.dataset._id,a=e.parentElement.dataset.type,r=e.closest(".modal");n.push(t),xhr({_id:o,[a]:n},"/backend/updateArrayItem",(function(e){if("success"===e){r.style.display="none";let e=document.querySelector("#select-"+o),l=document.createElement("option");makeAddBox(t,o,a,n),l.value=t,l.textContent=t,e.appendChild(l),l.setAttribute("selected","selected")}else r.document.querySelector(".warning").textContent="An error occured",r.document.querySelector(".warning").style.display="block"}))}function makeBlog(e){xhr(e,"/backend/blog",(function(e){document.querySelector(".maincontent").innerHTML=e,a();let t=document.querySelector(".postcontent"),n=document.querySelector(".postList");function o(){n.querySelectorAll(".deletepost").forEach((function(e){e.addEventListener("click",(function(e){e.stopPropagation(),xhr({_id:e.target.parentElement.dataset.id,title:e.target.parentElement.dataset.title},"/backend/blogdelete",(function(t){n.removeChild(e.target.parentElement)}))}))})),t.querySelector(".blogVideo").addEventListener("input",(function(e){e.target.nextSibling.addEventListener("click",(function(e){e.preventDefault();let t={timestamp:(new Date).getTime(),_id:document.querySelector(".postcontent").querySelector(".postview").dataset._id,title:document.querySelector(".title").value,video:document.querySelector(".blogVideo").files[0]},n=new FormData,o=Object.keys(t),a=Object.values(t);o.forEach((function(e,t){n.append(o[t],a[t])})),formxhr(n,"/backend/saveblogvideo",(function(e){let t=JSON.parse(e);if(t.error)swiftmoAlert.setContent(t.error).toggle();else{let e=document.createElement("div");e.style.display="flex";let n=document.createElement("video");n.setAttribute("src",t.link),n.setAttribute("autoplay",!0),n.style.maxWidth="100%",e.appendChild(n),makeButton(e,"deleteButton","x","delete",c),makeButton(e,"moveUpButton","⇧","move up",s),makeButton(e,"moveDownButton","⇩","move down",d),document.querySelector(".content").appendChild(e),swiftmoAlert.setContent(t.message).toggle(),n.scrollIntoView(!0)}}))}))}));let e=0;t.querySelector(".blogImage").addEventListener("input",(function(t){0===e&&t.target.nextSibling.addEventListener("click",(function(t){e=1,t.preventDefault();document.querySelector(".postcontent").querySelector(".postview").dataset._id;let n={timestamp:(new Date).getTime(),_id:document.querySelector(".postcontent").querySelector(".postview").dataset._id,title:document.querySelector(".title").value,image:document.querySelector(".blogImage").files[0]},o=new FormData,a=Object.keys(n),r=Object.values(n);a.forEach((function(e,t){o.append(a[t],r[t])})),formxhr(o,"/backend/saveblogimage",(function(e){let t=JSON.parse(e);if(t.error)swiftmoAlert.setContent(t.error).toggle();else{let e=document.createElement("div");e.style.display="flex";let n=document.createElement("img");n.setAttribute("src",t.link),n.style.maxWidth="100%",e.appendChild(n),makeButton(e,"deleteButton","x","delete",i),makeButton(e,"moveUpButton","⇧","move up",s),makeButton(e,"moveDownButton","⇩","move down",d),document.querySelector(".content").appendChild(e),swiftmoAlert.setContent(t.message).toggle(),n.scrollIntoView(!0)}}))}))})),n.querySelectorAll(".fetchpost").forEach((e=>{e.addEventListener("click",(e=>{xhr({_id:e.target.parentElement.dataset.id,provider:document.getElementById("profile").dataset.provider},"/backend/blogjson",(function(e){let t=JSON.parse(e).data[0];for(document.querySelector(".title").value=t&&t.title?t.title:"enter a tile",document.querySelector(".topicInput").value=t&&t.topics?t.topics.toString():"enter topics";document.querySelector(".content").firstChild;)document.querySelector(".content").removeChild(document.querySelector(".content").firstChild);t&&t.content&&(t.content.forEach((e=>{r(e.el,e.cont,".content")})),document.querySelector(".postdescription").value=t.description),t&&t._id&&(document.querySelector(".postcontent").querySelector(".postview").dataset._id=t._id),a(),document.querySelector(".content").scrollIntoView({block:"start",behavior:"smooth"})}))}))}))}function a(){if(document.querySelector(".controls").firstChild)return;let e=["paragraph","italic text","bold text","h1, main title","h2, sub title","h3, sub sub title","h4, minor title","figcaption, image caption","quotation"];["p","em","b","h1","h2","h3","h4","figcaption","quotation"].forEach(((t,n)=>{let o=document.createElement("button");o.classList.add("btnbackend","uniformdisplay","bounceOnHover");let a=document.createElement(t);a.textContent="Add "+e[n],o.appendChild(a),document.querySelector(".controls").appendChild(o),o.addEventListener("click",(function(e){e.preventDefault(),r(t,null,".content")}))}))}function r(e,t,n){let o=document.createElement("div");o.style.display="flex";let a=document.createElement(e);if(any(["img","video"],e))if("img"===e){t.includes("http://localhost:8080")&&t.replace("http://localhost:8080",".");a.setAttribute("src",t),o.appendChild(a),document.querySelector(n).appendChild(o),makeButton(o,"deleteButton","x","delete",i),makeButton(o,"moveUpButton","⇧","move up",s),makeButton(o,"moveDownButton","⇩","move down",d)}else"video"===e&&(a.setAttribute("src",t),a.setAttribute("controls",!0),a.setAttribute("autoplay",!0),o.appendChild(a),document.querySelector(n).appendChild(o),makeButton(o,"deleteButton","x","delete",c),makeButton(o,"moveUpButton","⇧","move up",s),makeButton(o,"moveDownButton","⇩","move down",d));else a.setAttribute("contentEditable",!0),a.classList.add("fieldEditable","fieldEditableUp"),a.textContent=t||"Your text",o.appendChild(a),document.querySelector(n).appendChild(o),makeButton(o,"deleteButton","x","delete",l),makeButton(o,"moveUpButton","⇧","move up",s),makeButton(o,"moveDownButton","⇩","move down",d);selectElementContents(a)}function l(e){document.querySelector(".content").removeChild(e.target.parentElement)}function i(e){let t=e.target.previousSibling.src,n=window.location.origin;var o=new RegExp(n,"gi");xhr({image:t.replace(o,""),_id:document.querySelector(".title").dataset.id,title:document.querySelector(".title").value},"/backend/blogimagedelete",(function(t){document.querySelector(".content").removeChild(e.target.parentElement);let n=JSON.parse(t);n.error?swiftmoAlert.setContent(n.error).toggle():swiftmoAlert.setContent(n.success).toggle()}))}function c(e){let t=e.target.previousSibling.src,n=window.location.origin;var o=new RegExp(n,"gi");xhr({video:t.replace(o,""),_id:document.querySelector(".title").dataset.id,title:document.querySelector(".title").value},"/backend/blogvideodelete",(function(t){document.querySelector(".content").removeChild(e.target.parentElement);let n=JSON.parse(t);n.error?swiftmoAlert.setContent(n.error).toggle():swiftmoAlert.setContent(n.success).toggle()}))}function s(e){let t=e.target.parentElement;document.querySelector(".content").insertBefore(t,t.previousSibling)}function d(e){let t=e.target.parentElement;document.querySelector(".content").insertBefore(t,t.nextSibling.nextSibling)}eventOnAll(".topics",(()=>activateDropDown.setState("topicsfilter").hideOrDisplay())),o(),swiftmoAlert.set();let u=document.createElement("button");u.classList.add("btnbackend","bounceOnHover","fetchnew"),u.textContent="Add new blog post",u.addEventListener("click",(function(){xhr({},"/backend/blognew",(function(e){document.querySelector(".postedit").innerHTML=e,a(),o()}))})),document.querySelector(".controlbuttonsnew").appendChild(u);let m=document.createElement("button");m.classList.add("btngreen","bounceOnHover","savepost"),m.textContent="save",m.addEventListener("click",(function(e){e.preventDefault();let t=document.querySelector(".title").dataset.id,a=document.querySelector(".title").value,r=document.querySelector(".topicInput").value,l=document.querySelector(".postdescription").value,i=[];Array.from(document.querySelector(".content").children).forEach((e=>{let t=e.firstChild;any(["IMG","VIDEO"],t.tagName)?i.push({el:t.tagName.toLowerCase(),cont:t.src}):i.push({el:t.tagName.toLowerCase(),cont:t.textContent})}));let c={_id:t,title:a,topics:r,description:l,content:i};void 0===document.querySelector(".title").dataset.id?xhr(c,"/backend/blogsavenew",(function(e){(e=JSON.parse(e)).error?swiftmoAlert.setContent(e.error).toggle():(swiftmoAlert.setContent("Post saved").toggle(),document.querySelector(".title").dataset.id=e._id,function(e,t,a){let r=document.createElement("li");r.dataset._id=e,r.dataset.topics=t,r.dataset.topics=a,r.textContent=a;let l=document.createElement("span");l.classList.add("bounceOnHover","btngreen","fetchpost"),l.textContent="fetch";let i=document.createElement("span");i.classList.add("bounceOnHover","btnwarn","deletepost"),i.textContent="delete",r.appendChild(l),r.appendChild(i),n.appendChild(r),o()}(e._id,r,a))})):xhr(c,"/backend/blogsave",(function(e){JSON.stringify(e).error?swiftmoAlert.setContent(e.error).toggle():swiftmoAlert.setContent("Post saved").toggle()}))})),document.querySelector(".controlbuttonssave").appendChild(m)}))}let activateDropDown=function(){let e,t={};return{setState:function(n){let o=document.getElementById(n);return e=o.options[o.selectedIndex].dataset.attribute,t[n]=e,this},hideOrDisplay:function(){let e=Object.values(t);document.querySelectorAll(".itemprofile").forEach((function(t){let n=0,o=Object.values(t.dataset);e.forEach((function(a,r){(o.includes(a)||void 0===a)&&n++,r===e.length-1&&(n===e.length?"DIV"===document.querySelectorAll(".itemprofile")[0].tagName?t.style.display="block":t.style.display="table-cell":t.style.display="none")}))}))}}}();function entityAlterEvents(){document.querySelectorAll(".edit").forEach(((e,t)=>{addTabIndex(e),e.addEventListener("click",(t=>{t.target.classList.remove("warning"),t.target.contentEditable="true",t.target.textContent="",t.target.focus(),e.addEventListener("input",(e=>{xhr({[e.target.dataset.fieldname]:isNaN(e.target.textContent)?e.target.textContent:parseInt(e.target.textContent)},"/backend/updateEntity",(function(e){}))}))}))})),saveTimes()}function saveTimes(){document.querySelector(".saveShopTimes").addEventListener("click",(function(e){e.preventDefault(),xhr({fullShopOpeningHours:shopCalendar.datesSelected(),openingHours:shopCalendar.jsonldFriendlyTimes()},"/backend/updateEntity",(function(e){swiftmoAlert.setContent("Dates saved").toggle()}))}))}function saveLocationTimes(e,t){xhr({[t+".fullShopOpeningHours"]:e.datesSelected(),[t+".openingHours"]:e.jsonldFriendlyTimes()},"/backend/updateEntity",(function(e){swiftmoAlert.setContent("Dates saved").toggle()}))}function saveLocation(e,t){xhr({[e]:t},"/backend/updateEntity",(function(e){swiftmoAlert.setContent("Location saved").toggle()}))}function editEvents(){document.querySelectorAll(".edit").forEach(((e,t)=>{e.addEventListener("click",(t=>{t.target.classList.remove("warning"),t.target.classList.add("attention"),t.target.contentEditable="true",t.target.focus(),document.querySelectorAll(".edit").forEach(((t,n)=>{t!==e&&(t.classList.remove("fieldEditableUp","attention"),t.contentEditable="false")}))}))}))}function addStockChangeEvents(){editEvents(),document.querySelectorAll(".dropdownsave").forEach(((e,t)=>{e.addEventListener("change",(e=>{let t=e.target.dataset.type,n=e.target.options[e.target.selectedIndex].value;xhr({itemref:e.target.closest(".itemprofile").dataset.itemref,[t]:n},"./updateItemField",(function(e){}))}))})),document.querySelectorAll(".filter").forEach((e=>{e.addEventListener("change",(e=>{let t=document.querySelector(".filterPattern").value,n=document.querySelector(".filterItemType").value;document.querySelectorAll(".stockItems").forEach((e=>{let o=""===t||e.dataset.pattern===t,a=""===n||e.dataset.itemtype===n;o&&a?(e.classList.remove("hide"),e.classList.add("displayFlex")):(e.classList.add("hide"),e.classList.remove("displayFlex"))}))}))}))}function CurrencyInput(e,t){e.addEventListener("input",(a=>{a.target.focus(),function(e){if(0===e.textContent.length)return;let o=e.textContent.match(/\d+/g),a=o.join("").split(""),r=o.join("");a.splice(a.length,0,a[0]),a.shift(),n=a.join(""),1===r.length&&a.splice(0,0,".0");"0"===a[0]&&3===a.length&&a.shift();r.length>2&&a.splice(a.length-2,0,".");if(a.length>=6)for(i=6;i<a.length;)a.splice(a.length-i,0," "),i+=4;e.textContent=t+" "+a.join(""),e.dataset.incent=n}(e),o()})),e.parentElement.parentElement.querySelector(".tax").addEventListener("input",(e=>{o()}));let n=0;function o(){let o=parseInt(e.parentElement.parentElement.querySelector(".tax").value),r=e.parentElement.parentElement.querySelector(".taxCalc");val=Math.round(n-n/(100+o)*100),r.textContent=a(val,t)}function a(e,t){let n=e.toString().split("");if(1===n.length&&n.splice(n.length-2,0,"0"),n.splice(n.length-2,0,"."),n.length>6)for(let e=6;e<n.length;e+=4)n.splice(n.length-e,0," ");return st=n.join(""),t+" "+st}this.incent=()=>n,this.formatOnly=(e,t)=>{a(e,t)},this.resolveInCent=e=>{let t=e.textContent.match(/\d+/g);t.join("").split("");return t.join("")},e.addEventListener("keydown",(function(t){const n=t.key;if("Backspace"===n||"Delete"===n){let t=e.textContent;e.textContent=t.slice(0,4)+t.slice(5,t.length),7===t.length&&(e.textContent=t.slice(0,4)+t.slice(8,t.length))}}))}function FuzzySearch(e){let t=[],n=[];Array.from(e.children).forEach(((e,o)=>{t.push(e.value),n.push(e.dataset.iteminfo)})),this.pushToList=function(e,n){return t.push(e),n.push(n),this},e.previousSibling.addEventListener("input",(function(o){let a=o.target.value;for(;e.firstChild;)e.removeChild(e.lastChild);t.forEach(((t,o)=>{if(t.includes(a)){let a=document.createElement("option");a.value=t,a.textContent=t,a.dataset.iteminfo=n[o],e.appendChild(a)}}))}));let o=e.parentElement&&e.parentElement.nextElementSibling?e.parentElement.nextElementSibling.querySelector(".itemNewName"):null;if(o){let e=o.parentElement.parentElement.querySelector(".warning");o.addEventListener("input",(n=>{let o=n.target.textContent;for(let n=0;n<t.length;n++){if(t[n]===o){e.textContent=o+" is already in use, choose another name unless you mean to overwrite it "+o,e.classList.remove("hide");break}e.textContent="",e.classList.add("hide")}}))}}!function(){var e=[];domadd={append:function(t,n,o,a,r,l,i){var c=document.createElement(t);return n&&(c.textContent=n),a&&a.forEach((function(e){c.classList.add(e)})),r&&(c.id=r),l&&l.forEach((function(e,t){c.setAttribute(Object.keys(e)[0],e[Object.keys(e)[0]])})),o instanceof Element||o instanceof HTMLDocument?o.append(c):"ChildOfPrev"===o?e[e.length-1].append(c):document.querySelector(o).append(c),e.push(c),this}},domadd}(),window.addEventListener("DOMContentLoaded",(e=>{swiftmoAlert.set(),"https:"!==location.protocol&&console.warn("not over https"),"/app-set-up"===window.location.pathname&&(entityAlterEvents(),editEvents())})),document.addEventListener("click",(function(e){if(e.target.classList.contains("submitNewUser")){if(e.preventDefault(),document.querySelector('[name="password"]').value!==document.querySelector('[name="passwordCheck"]').value)return void swiftmoAlert.setContent("Password doesn't match the repeat password").toggle();{let e=new FormData;e.append("username",document.querySelector('[name="username"]').value),e.append("password",document.querySelector('[name="password"]').value),formxhr(e,"/register-seed-user",(e=>{swiftmoAlert.setContent(e+" Redirecting to the backend in a moment.").toggle(),window.setTimeout((function(){window.location.pathname="/backend"}),1500)}))}}if(e.target.classList.contains("loginButton")){e.preventDefault();let t={username:document.querySelector("#username").value,password:document.querySelector("#password").value},n=new XMLHttpRequest;n.open("POST","/backend/backendlogin",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t)),n.onreadystatechange=function(e){n.readyState===XMLHttpRequest.DONE&&200===n.status&&location.reload(),401===n.status&&(document.querySelector(".loginError").innerHTML="Unauthorized. Please check your username and password.")}}if(e.target.classList.contains("logout")&&(e.preventDefault(),xhr({},"/backend/logout",(function(e){"OK"===e&&location.reload()}))),"docs"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/docs",(function(e){document.querySelector(".maincontent").innerHTML=e}))),e.target.classList.contains("toggleDocs")){e.preventDefault();let t=document.querySelectorAll(".microdocs");for(let e=0;e<t.length;e++)any(["block",""],t[e].style.display)?t[e].style.display="none":t[e].style.display="block"}if(e.target.classList.contains("cloneType")){e.preventDefault();let t=JSON.parse(e.target.parentElement.parentElement.dataset.items)[0].itemref,n=e.target.parentElement.querySelector(".numberInput").value;xhr({itemref:t,count:n},"/backend/cloneItem",(function(t){if("OK"===t){let t=e.target.parentElement.querySelector(".countval");t.textContent=parseInt(t.textContent)+parseInt(n)}else alert("oops an error occured")}))}if(e.target.classList.contains("editItem")){e.preventDefault();let t=JSON.parse(e.target.parentElement.parentElement.dataset.items);xhr({itemref:t[0].itemref,count:e.target.parentElement.querySelector(".numberInput").value,allItems:t},"/backend/editItem",(function(t){e.target.parentElement.parentElement.nextElementSibling.innerHTML=t,e.target.parentElement.parentElement.nextElementSibling.scrollIntoView({block:"start",behavior:"smooth",inline:"center"}),attachImageLoadEvent(),addStockChangeEvents(),addOption(),document.querySelectorAll(".currency").forEach(((e,t)=>{new CurrencyInput(e,"EUR")})),document.querySelectorAll(".fuzzySearch").forEach(((e,t)=>{new FuzzySearch(e.nextSibling)})),document.querySelectorAll(".tax").forEach(((e,t)=>{new PercentInput(e)})),n()}))}function t(e,t){let n=JSON.parse(e.target.parentElement.parentElement.dataset.items),o=e.target.parentElement.querySelector(".numberInput").value,a=e.target.parentElement.parentElement.dataset.itemtype,r=()=>o<n.length?n.slice(n.length-o):n,l=t?{itemtype:a,itemrefs:r(),templateItem:!0}:{itemtype:a,itemrefs:r()};function i(){xhr(l,"/backend/removestock",(function(t){if("OK"===t){let t=e.target.parentElement.querySelector(".countval"),n=parseInt(t.textContent)-parseInt(o),a=e.target.parentElement.parentElement,r=document.querySelector(".maincontent");n<0?r.removeChild(a):t.textContent=n}else alert("oops an error occured")}))}t?window.confirm("Warning, deleting a template item will mean the item information will be lost, are you sure you want to continue?")&&i():window.confirm("Are you sure you want to remove "+o+" items from stock?")&&i()}if(e.target.classList.contains("removeTemplateItem")&&(e.preventDefault(),t(e,!0)),e.target.classList.contains("removeItems")&&(e.preventDefault(),t(e,!1)),e.target.classList.contains("resetFilters")&&(e.preventDefault(),document.querySelectorAll(".stockItems").forEach(((e,t)=>{e.classList.remove("hide"),e.classList.add("displayFlex")}))),"sales"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/sales",(function(e){document.querySelector(".maincontent").innerHTML=e}))),e.target.classList.contains("uploadvideo")&&(e.preventDefault(),saveVideo(e.target.previousSibling)),e.target.classList.contains("togglemodal")){let t=e.target.nextElementSibling;toggle.setinst(t),toggle.tog(t,"block"),t.querySelector(".circleClose").addEventListener("click",(function(){toggle.tog(t,"none")}))}if("shop"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/shopchoices",(function(e){document.querySelector(".maincontent").innerHTML=e,attachImageLoadEvent(),addStockChangeEvents()}))),"entity"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/entity",(function(t){document.querySelector(".maincontent").innerHTML=t;let n=document.querySelectorAll(".locationTimetable")[0];shopCalendar=(new SwiftCal).calendar(n,JSON.parse(n.dataset.dates),12,!0,!1,!1,!0);let o=new MapFunctions(".locationMap","400px");if(o.generateMap("https://tile.openstreetmap.org/${z}/${x}/${y}.png\t").locateOnClick(!0,null,null,!1).invalidateSize(),$(".locationMap").dataset.location&&JSON.parse($(".locationMap").dataset.location).lat&&JSON.parse($(".locationMap").dataset.location).lng){let e=JSON.parse($(".locationMap").dataset.location);o.addGuideMarker(e,"Business location "+e.lat+","+e.lng)}$(".locationMap").addEventListener("click",(function(){let e=o.returnCoordinates();$(".locationMap").nextSibling.textContent="Your chosen coordinates"+e.lat+","+e.lng})),$(".locationMap").nextSibling.nextSibling.addEventListener("click",(function(){e.preventDefault(),saveLocation("location",o.returnCoordinates())}));let a=[],r=[];if($(".pointsOfSale").firstChild){let t=document.querySelector(".pointsOfSale").querySelectorAll(".locationTimetable");for(let n=0;n<t.length;n++)a[n]=(new SwiftCal).calendar(t[n],JSON.parse(t[n].dataset.dates),12,!0,!1,!1,!0),t[n].nextSibling.addEventListener("click",(function(){e.preventDefault(),saveLocationTimes(a[n],t[n].dataset.fieldname)}));let n=document.querySelector(".pointsOfSale").querySelectorAll(".locationMap");for(let t=0;t<n.length;t++){let o=JSON.parse(n[t].dataset.location);r[t]=new MapFunctions(n[t],"400px"),r[t].generateMap("https://tile.openstreetmap.org/${z}/${x}/${y}.png").locateOnClick(!0,null,null,!1).invalidateSize(),o.lat&&r[t].addGuideMarker(o,"Business location "+o.lat+","+o.lng),n[t].nextSibling.nextSibling.addEventListener("click",(function(){e.preventDefault(),saveLocation(n[t].dataset.fieldname+".location",r[t].returnCoordinates())}))}}entityAlterEvents()}))),e.target.classList.contains("baseelem")){addNewPointOfSale(document.querySelector(".pointsOfSale").querySelectorAll(".singlePointOfSale")[0])}function n(){document.querySelectorAll(".arraymodaltype").forEach((e=>{toggle.setinst(e),e.querySelectorAll(".circleClose").forEach(((t,n)=>{t.addEventListener("click",(()=>{toggle.tog(document.querySelector(".itemtypesuccess"),"none"),toggle.tog(e,"none")}))})),e.querySelectorAll(".save").forEach((e=>{e.addEventListener("click",(()=>{saveFn(e)}))}))}))}if("viewstock"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/viewstock",(function(e){document.querySelector(".maincontent").innerHTML=e,addStockChangeEvents(),attachImageLoadEvent()}))),"addstock"===e.target.id&&(e.preventDefault(),xhr({user:document.getElementById("profile").dataset.user},"/backend/addstock",(function(e){document.querySelector(".maincontent").innerHTML=e,attachImageLoadEvent(),addStockChangeEvents(),addOption(),document.querySelectorAll(".currency").forEach(((e,t)=>{new CurrencyInput(e,"EUR")})),document.querySelectorAll(".fuzzySearch").forEach(((e,t)=>{new FuzzySearch(e.nextSibling)})),document.querySelectorAll(".tax").forEach(((e,t)=>{new PercentInput(e)})),n()}))),e.target.classList.contains("expand")&&(e.target.closest("p").nextSibling.classList.remove("hide"),e.target.style.display="none",e.target.parentElement.querySelector(".contract").style.display="block"),e.target.classList.contains("contract")&&(e.target.closest("p").nextSibling.classList.add("hide"),e.target.style.display="none",e.target.parentElement.querySelector(".expand").style.display="block"),e.target.classList.contains("remove")){let t=e.target.parentElement.dataset._id,n=e.target.parentElement.dataset.type,o=document.querySelector("#addNewModal-"+n),a=JSON.parse(o.dataset.values),r=e.target.parentElement.previousSibling.textContent,l=e.target.parentElement.parentElement;e.target.parentElement.parentElement.parentElement.removeChild(l),a.splice(a.indexOf(r),1),o.dataset.values=JSON.stringify(a),xhr({_id:t,[n]:a},"/backend/updateArrayItem",(function(e){if("success"===e){swiftmoAlert.setContent(n+"successfully updated.").toggle(),whipe();let e=document.querySelector("#select-"+t),o=e.querySelector("option[value='"+r+"']");e.removeChild(o)}else o.document.querySelector(".warning").textContent="An error occured",o.document.querySelector(".warning").style.display="block"}))}if(e.target.classList.contains("editmodal")){let t=e.target.parentElement.dataset.field,n=t.replace(" ","_"),o=document.querySelector("#editmodal-"+n),a=e.target.parentElement.previousSibling,r=(a.value,a[a.selectedIndex].dataset.iteminfo?JSON.parse(a[a.selectedIndex].dataset.iteminfo):{dimensions:[0,0,0],weight:0,name:""});if(o.style.display="block",document.querySelector("#"+n).textContent=r.name,document.querySelector("#"+n).dataset.newname=r.name,"item type"===t&&(document.querySelector(".x").textContent=r.dimensions[0],document.querySelector(".y").textContent=r.dimensions[1],document.querySelector(".z").textContent=r.dimensions[2],document.querySelector(".itemNewWeight:not(.parent)").textContent=r.weight),"producer"===t&&(document.querySelector(".producerIntro").textContent=r["quick intro"],document.querySelector(".producerType").textContent=r.type),"theme"===t){let e=document.querySelector("#editmodal-theme").querySelector("#select-blogPost");r.colours&&r.colours.forEach(((e,t)=>{o.querySelector(".colours").querySelectorAll(".array")[t].textContent=e})),r["meta description"]&&($(".themeDescription").textContent=r["meta description"]),r["linked post"]&&setOption(e,r["linked post"])}if(any(["theme","producer"],t)){o.querySelectorAll(".distinctImage")[0].querySelector(".title").textContent=r.name+" images",characterCount(o.querySelector(".characterCountInput"),o.querySelector(".characterCount"),160),rightpics(o,r),addTabIndex(o),addImageEvent()}}if(e.target.classList.contains("add-theme")&&(resetImages(e.target,"theme"),resetItemFields(e.target,"theme")),e.target.classList.contains("add-producer")&&(resetImages(e.target,"producer"),addItemType([document.querySelector("#itemNewName-producer"),document.querySelector(".producerIntro"),document.querySelector(".producerType")])),e.target.classList.contains("add-item_type")&&(whipe(),addItemType([document.querySelector("#item_type"),document.querySelector(".itemNewWeight")]),editDimensions(e.target)),e.target.classList.contains("editdimensions")&&editDimensions(e.target),e.target.classList.contains("stock"!==e.target.dataset.type)&&deleteImage(e.target),e.target.classList.contains("deleteItemType")){let t=e.target.closest(".stockModal"),n=t.querySelector(".itemNewName").textContent,o=(e.target.dataset._id,e.target.dataset.itemtype);xhr({name:n,type:o},"/backend/deleteItemType",(function(a){if("OK"===a){resetImages(e.target,o.replace(" ","_")),resetItemFields(e.target,o.replace(" ","_")),toggle.tog(t.parentElement,"none"),swiftmoAlert.setContent(a+" deleting "+n+" "+o).toggle();let r=document.querySelector("#select-"+o.replace(" ","_"));r.removeChild(r.options[r.selectedIndex])}else t.querySelector(".warning").textContent="An error occured",t.querySelector(".warning").style.display="block"}))}if(e.target.classList.contains("savestock")&&savenew(e.target),e.target.classList.contains("editstock")&&saveItemEdit(e.target),e.target.classList.contains("saveitemtype")){if("item type"===e.target.dataset.itemtype){let t=[];t.push(parseInt(document.querySelector(".x").textContent)),t.push(parseInt(document.querySelector(".y").textContent)),t.push(parseInt(document.querySelector(".z").textContent));let n=document.querySelector("#item_type").textContent;if(n.match(/(&nbsp)/g))return void alert("That item name includes HTML Char &nbsp, type the value in instead of cut and paste.");if(n.match(/([ ]{2,})/g))return void alert("That item name includes double spacing or new line characters or HTML entities, this name isn't allowed");let o={dimensions:t,weight:parseInt(document.querySelector(".itemNewWeight").textContent),name:n,"item group":document.getElementById("item_type.item_group").textContent.length>1?document.getElementById("item_type.item_group").textContent:document.getElementById("select-item_type.item_group").value,itemtype:"item type"};save({_id:e.target.parentElement.dataset._id,updates:o}),writeThemeChanges(o,"item_type")}if("producer"===e.target.dataset.itemtype){save({_id:e.target.parentElement.dataset._id,updates:{Producer:"artist","@type":"person",name:document.querySelector("#itemNewName-producer").textContent,"quick intro":document.querySelector(".producerIntro").textContent,type:document.querySelector(".producerType").textContent,itemtype:"producer"}}),document.querySelector("#editmodal-theme").style.display="none"}if("theme"===e.target.dataset.itemtype){let t=e.target.parentElement.dataset._id,n=document.querySelector("#theme").textContent,o=document.querySelector(".themeDescription").textContent,a=document.querySelector("#editmodal-theme").querySelector("#select-blogPost").value,r=document.querySelector('[data-fieldname="for bespoke"]').querySelector('[type="checkbox"]').checked,l={name:n,colours:getArrayTypeInput($(".colours")),itemtype:"theme","meta description":o,"linked post":a,"for bespoke":r};save({_id:t,updates:l}),writeThemeChanges(l,"theme"),document.querySelector("#editmodal-theme").style.display="none"}}if(e.target.classList.contains("viewEdit")){e.target.parentElement.dataset._id,e.target.parentElement.dataset.type,JSON.parse(e.target.parentElement.dataset.values);toggle.setinst(e.target.parentElement.parentElement.nextElementSibling),toggle.tog(e.target.parentElement.parentElement.nextElementSibling,"block")}if("blog"===e.target.id){makeBlog({}),attachImageLoadEvent()}}));const imageAPI=function(){let t,n,o;return obj={setUpCanvas:function(e,a,r){return t=document.querySelector(e),n=t.getContext(a),o=document.querySelector(r),o.onchange=function(){var e=o.files[0];obj.drawOnCanvas(e,n,t)},this},drawOnCanvas:function(e,t,n){let o=new FileReader;return o.onload=function(e){let o=e.target.result,a=new Image;a.onload=function(){t.drawImage(a,0,0,a.width,a.height,0,0,n.width,n.width*(a.width/a.height))},a.src=o},obj.displayTitle(n),o.readAsDataURL(e),this},displayTitle:function(e){return(e.previousSibling.tagName="P")&&(e.previousSibling.textContent="New item image:"),this},saveImage:function(e,t,n){if(e){let e=new FormData;for(var a in t)e.append(a,t[a]);e.append("image",o.files[0]),formxhr(e,"/backend/saveitemimage",(function e(t){e(t)}))}return this},loadImageToCanvas:function(t,o,a){let r=new FileReader;return r.onload=function(e){let t=new Image;t.onload=function(){o.width=img2.width,o.height=img2.height,imgheight=img2.height,imgwidth=img2.width,n.drawImage(this,0,0,imgwidth,imgheight)},t.src=e.target.result},r.readAsDataURL(e.target.files[0]),this}}}();function attachImageLoadEvent(e){document.querySelectorAll(".imageInput").forEach(((t,n)=>{t.addEventListener("change",(n=>{let o=n.target.parentElement.querySelector(".displayImage"),a=new FileReader,r=n.target.files[0];r&&a.readAsDataURL(r),a.addEventListener("load",(()=>{if(symlink=a.result,o.children[0]&&o.removeChild(o.children[0]),!o.children[0]){let a=document.createElement("img");a.setAttribute("src",symlink),o.appendChild(a);let r=e||n.target.closest(".distinctImage");addImageEvent(),saveImage(r,t)}}))}))}))}let imageEventTracker=[];function addImageEvent(){let e=document.querySelectorAll(".distinctImage");for(let t=0;t<e.length;t++)e[t].querySelector(".addimage")&&!imageEventTracker.includes(e[t].querySelector(".addimage"))&&(e[t].querySelector(".addimage").addEventListener("click",(e=>{makeAddImage(e.target.parentElement,"new image label","")})),imageEventTracker.push(e[t].querySelector(".addimage")))}function saveImage(e,t){"stock"===e.dataset.type?saveNewItem(e,t):"theme"===e.dataset.type?themeImage(e,t):"producer"===e.dataset.type?producerImage(e,t):"placeholderimage"===e.dataset.type?placeholderimage(e,t):itemtypeAlter(e,t)}function saveOnAddName(e,t){let n=document.createElement("button");n.classList.add("btngreen","sms2","bounceOnHover","block"),n.textContent="Save Image",n.style.margin="1em",n.addEventListener("click",(n=>{"stock"===e.dataset.type?saveNewItem(e,t):itemtypeAlter(e,t)}));let o=e.querySelector(".imagetype");o.parentNode.insertBefore(n,o.nextSibling)}function saveNewItem(e,t){""===e.querySelector(".imagetype").value&&(e.querySelector(".imagetype").value="no label given");let n=e.dataset.type,o=(new Date).getTime();sendImage({itemref:e.dataset.itemref,altered:o,itemtype:"stock",photoLabel:e.querySelector(".imagetype").value,image:t.files[0],theme:document.querySelector("#select-theme").value,"item type":document.querySelector("#select-item_type").value,producer:document.querySelector("#select-producer").value,tax:document.querySelector(".tax").value,price:document.querySelector(".price").value,special:document.querySelector(".special").checked},"/backend/saveitem",(function(t){swiftmoAlert.setContent(n+" image saved").toggle(),e.querySelector(".deleteImage").addEventListener("click",(function(n){xhr({link:JSON.parse(t).link},"/backend/deleteImage",(function(){let t=e.querySelector(".lazyImage").firstChild;e.querySelector(".lazyImage").removeChild(t)}))}))}))}function itemtypeAlter(e,t){if(e.querySelector(".imagetype")&&""===e.querySelector(".imagetype").value)return saveOnAddName(e,t),void swiftmoAlert.setContent("Remember to label this image, it won't save without a name. Click the save image button once it's named").toggle();let n=(new Date).getTime(),o=e.dataset.type,a=document.querySelector("#theme").textContent;sendImage({itemref:e.dataset.itemref,theme:a,timestamp:n,photoLabel:e.querySelector(".imagetype").value,"item type":o,image:t.files[0]},"/backend/saveitem",(function(e){swiftmoAlert.setContent(o+" image saved").toggle()}))}function placeholderimage(e,t){let n=(new Date).getTime();e.dataset.value;sendImage({timestamp:n,photoLabel:e.dataset.value,image:t.files[0]},"/backend/saveplaceholder",(function(t){swiftmoAlert.setContent(e.dataset.value+" image saved").toggle()}))}function themeImage(e,t){if(""===e.querySelector(".imagetype").value)return saveOnAddName(e,t),void swiftmoAlert.setContent("Remember to label this image, it won't save without a name. Click the save image button once it's named").toggle();sendImage({photoLabel:e.querySelector(".imagetype").value,themename:document.querySelector("#theme").textContent,image:t.files[0]},"/backend/saveThemeImage",(function(t){e.closest(".distinctImage").querySelector("img").src=JSON.parse(t).link,gthing=e.closest(".distinctImage").querySelector("img"),swiftmoAlert.setContent("theme image saved").toggle()}))}function producerImage(e,t){if(""===e.querySelector(".imagetype").value)return saveOnAddName(e,t),void swiftmoAlert.setContent("Remember to label this image, it won't save without a name. Click the save image button once it's named").toggle();sendImage({role:e.closest(".editmodal").querySelector(".producerType").textContent,photoLabel:e.querySelector(".imagetype").value,name:document.querySelector("#producer").textContent,image:t.files[0]},"/backend/saveProducerImage",(function(e){swiftmoAlert.setContent("producer image saved").toggle()}))}function sendImage(e,t,n){let o=new FormData,a=Object.keys(e),r=Object.values(e);return a.forEach((function(e,t){"image"!==e&&o.append(a[t],r[t]),t===a.length-1&&o.append("image",r[a.indexOf("image")])})),formxhr(o,t,(function(e){n(e)})),this}function makeButton(e,t,n,o,a,r,l){var i=document.createElement("p");i.id=t,i.textContent=n,e.appendChild(i),i.title=o,i.classList.add("deleteButton"),i.addEventListener("click",(function(e){a(e,r,l)}))}function addItemType(e){e.forEach(((e,t)=>{e.textContent=e.classList.contains("itemNewWeight")?0:"",e.classList.add("fieldEditableUp"),e.contentEditable="true"})),e[0].focus()}function deleteVideo(e){let t;t=e.closest(".distinctVideo").querySelector("videoDisplay").src}function deleteImage(e){let t,n,o,a;t=e.closest(".distinctImage").querySelector("img").src.split("/images")[1],"true"!==e.dataset.edit?(n=updateData(e),o=e.dataset.type,a=document.querySelector("#"+o).textContent,xhr({link:"/images"+t,itemtype:o,name:a,"image links":n},"/backend/deleteImage",(t=>{"success"===t&&swiftmoAlert.setContent("Image successfully deleted.").toggle(),e.closest(".images").querySelectorAll(".distinctImage").length>1?e.closest(".distinctImage").remove():(e.closest(".distinctImage").querySelector(".imagetype").value="",e.closest(".distinctImage").querySelector("img").src="",e.closest(".distinctImage").querySelector(".imageInput").files[0]="")}))):deleteStockImage(e)}function deleteStockImage(e){let t,n,o,a;t=e.closest(".distinctImage").querySelector("img").src.split("/images")[1],n=e.closest(".distinctImage").dataset.itemref,o=e.dataset.theme,a=e.dataset.type,xhr({link:"/images"+t,theme:o,itemtype:a,itemref:n},"/backend/updateOrDeleteStockItemImage",(t=>{"success"===t&&swiftmoAlert.setContent("Image successfully deleted.").toggle(),e.closest(".images").querySelectorAll(".distinctImage").firstChild?e.closest(".distinctImage").remove():(e.closest(".distinctImage").querySelector(".imagetype").value="",e.closest(".distinctImage").querySelector("img").src="",e.closest(".distinctImage").querySelector(".imageInput").files[0]="")}))}function updateData(e){if("stock"===!e.dataset.type){let t=$("#select-"+e.dataset.type),n=document.querySelector("#"+e.dataset.type).dataset.newname,o="/images"+e.closest(".distinctImage").querySelector("img").src.split("/images")[1],a=getOptionByValue(t,n).dataset.iteminfo,r=JSON.parse(a),l=r["image links"],i=l.indexOf(decodeURI(o));if(i>-1)return r["image links"]=l.splice(i,1)&&l,toUpdates=JSON.stringify(r),r}}function addNewPointOfSale(e){let t=e.cloneNode(!0);document.querySelector(".pointsOfSale").appendChild(t);let n=t.querySelector(".locationTimetable");n.replaceChildren();(new SwiftCal).calendar(n,null,12,!0,!1,!1,!0);let o=t.querySelectorAll("[data-fieldname]");for(let e=0;e<o.length;e++)o[e].dataset.fieldname="otherPointsOfSale."+document.querySelector(".pointsOfSale").childNodes.length-1+"."+o[e].dataset.fieldname,e===o.length-1&&entityAlterEvents();let a=document.querySelectorAll(".switchtitle");for(let e=0;e<a.length;e++)a[e].textContent=a[e].textContent.replace(/(.usiness)/g,"Point of sale")}function makeAddImage(e,t,n){let o=e.cloneNode(!0);null!==o.querySelector("img")?(e.parentElement.appendChild(o),o.querySelector(".imagetype").value=t,o.querySelector("img").setAttribute("src",n),o.querySelector(".uploadimage").dataset.value=t,attachImageLoadEvent(o),addImageEvent(),editEvents()):swiftmoAlert.setContent("Please use the first image adder before adding another one.").toggle()}function resetImages(e,t){let n=e.closest(".stockModal").querySelector(".imagetype");if(!n)return;n.value="",n.classList.add("fieldEditableUp"),n.contentEditable="true",e.closest(".stockModal").querySelector(".distinctImage").querySelector(".title").textContent="Add images:";let o=e.closest(".stockModal").querySelectorAll(".distinctImage");for(var a=1;a<o.length;a++)o[a].remove();e.closest(".stockModal").querySelector(".editImages").addEventListener("click",(e=>{let t=e.target.closest(".stockModal").querySelector(".title"),n=e.target.closest(".stockModal").querySelector(".itemNewName");""===n.textContent?(swiftmoAlert.setContent("Enter a name first.").toggle(),t.textContent="images"):t.textContent=n.textContent+" images"}));let r=e.parentElement.parentElement.querySelector(".displayImage");r.childNodes.forEach(((e,t)=>{r.removeChild(e)}))}function resetItemFields(e,t){e.closest(".stockModal").querySelectorAll(".edit").forEach(((e,t)=>{e.textContent=""}));let n=document.querySelector("#"+t);n.textContent="",n.classList.add("fieldEditableUp"),n.classList.remove("uneditable"),n.contentEditable="true",n.focus()}function editDimensions(e){Array.from(e.closest(".editmodal").querySelectorAll(".dimensions")).forEach((e=>{e.classList.add("fieldEditableUp"),e.classList.remove("warning"),e.contentEditable="true",e.focus()}))}function getArrayTypeInput(e,t){let n=[],o=e.querySelectorAll(".array");for(var a=0;a<o.length;a++)if(0===o[a].textContent.length||(isNaN(o[a].textContent)?n.push(o[a].textContent):n.push(parseInt(o[a].textContent))),a===o.length-1)return n}function writeThemeChanges(e,t){let n=document.querySelector("#select-"+t),o=document.createElement("option"),a=e.name,r=document.querySelector("#editmodal-"+t).querySelectorAll(".distinctImage"),l=e;l["image links"]=[],any(["theme","producer"],t)&&r.forEach(((e,i)=>{if(e.querySelector(".imageInput").files[0]){let c=e.querySelector(".imagetype").value,s=e.querySelector(".imageInput").files[0].name.split(".")[1];l["image links"].push("/images/stock/"+t+"/"+a+"/"+a+"-"+c+"."+s),i===r.length-1&&(o.dataset.iteminfo=JSON.stringify(l),o.value=a,o.textContent=a,n.appendChild(o),o.setAttribute("selected","selected"))}})),"item_type"===t&&(o.dataset.iteminfo=JSON.stringify(l),o.value=a,o.textContent=a,n.appendChild(o),o.setAttribute("selected","selected"))}function save(e){xhr(e,"/backend/updateItemType",(function(e){if("success"===e){swiftmoAlert.setContent(e).toggle(),window.setTimeout((function(){document.querySelectorAll(".arraymodaltype").forEach(((e,t)=>{toggle.tog(e,"none")}))}),500)}else modal.document.querySelector(".warning").textContent="An error occured",modal.document.querySelector(".warning").style.display="block"}))}function extractArrayOfText(e){let t=Array.from(e),n=[];for(let e=0;e<t.length;e++)if(n.push(t[e].textContent),e===t.length-1)return n}function option(){let e=[],t=Array.from(document.querySelector(".optionsContainer").querySelectorAll(".optionContainer"));for(let n=0;n<t.length;n++)if(e.push({"option name":t[n].querySelector(".optionName").textContent,choices:Array.from(t[n].querySelectorAll(".choice")).map((e=>e.textContent))}),n===t.length-1)return e}function addOption(){let e=document.querySelector(".optionsContainer").querySelectorAll(".optionContainer")[0].cloneNode(!0);function t(n){n.target.classList.contains("addAnotherOption")&&(document.querySelector(".optionsContainer").appendChild(e),document.querySelector(".optionsContainer").addEventListener("click",t),editEvents()),n.target.classList.contains("addAnotherChoice")&&function(e){let t=e.target.closest(".choiceContainer").firstElementChild.cloneNode(!0);e.target.closest(".choiceContainer").appendChild(t),editEvents()}(n)}document.querySelector(".optionsContainer").addEventListener("click",t)}function savenew(e){xhr({updates:{theme:JSON.parse(optData($("#select-theme"),"iteminfo")),"item type":JSON.parse(optData($("#select-item_type"),"iteminfo")),producer:JSON.parse(optData($("#select-producer"),"iteminfo")),price:parseInt($(".price").dataset.incent),tax:getInt($(".tax").value),special:$(".special").checked,"linked post":JSON.parse(optData($("#select-blogPost"),"iteminfo")),description:document.querySelector("#description").textContent,"key characteristics":extractArrayOfText(document.querySelectorAll('[data-fieldname="key features-listitem"]')),templateItem:!$(".special").checked,itemref:e.closest(".newitemprofile").dataset.itemref,options:option(),currency:document.querySelector("#currency").textContent}},"/backend/updateItem",(function(e){if("success"===e){swiftmoAlert.setContent("Item successfully added").toggle(),window.setTimeout((function(){document.querySelectorAll(".arraymodaltype").forEach(((e,t)=>{toggle.tog(e,"none")}))}),500)}else modal.document.querySelector(".warning").textContent="An error occured",modal.document.querySelector(".warning").style.display="block"}))}function saveItemEdit(e){xhr({updates:{theme:JSON.parse(optData($("#select-theme"),"iteminfo")),"item type":JSON.parse(optData($("#select-item_type"),"iteminfo")),producer:JSON.parse(optData($("#select-producer"),"iteminfo")),price:parseInt($(".price").dataset.incent),tax:getInt($(".tax").value),special:$(".special").checked,"linked post":JSON.parse(optData($("#select-blogPost"),"iteminfo")),description:document.querySelector("#description").textContent,"key characteristics":extractArrayOfText(document.querySelectorAll('[data-fieldname="key features-listitem"]')),itemref:e.closest(".newitemprofile").dataset.itemref,options:option(),currency:document.querySelector("#currency").textContent},itemrefs:JSON.parse(document.querySelector(".editstock").dataset.itemstoedit)},"/backend/saveItemEdit",(function(e){if("success"===e){swiftmoAlert.setContent("Item type edited").toggle(),window.setTimeout((function(){document.querySelector(".editItemDiv").innerHTML=""}),500)}else modal.document.querySelector(".warning").textContent="An error occured",modal.document.querySelector(".warning").style.display="block"}))}function rightpics(e,t){removepics(e,t).then(addpics)}function removepics(e,t){return new Promise(((n,o)=>{let a=e.querySelectorAll(".distinctImage");if(0===a.length)n([t,e]);else for(let o=0;o<a.length;o++)0===o?(a[o].querySelector("img")&&a[o].querySelector("img").remove(),a[o].querySelector(".imagetype").value=name):a[o].remove(),o===a.length-1&&n([t,e])}))}function addpics(e){let t=e[0],n=e[1];return new Promise(((e,o)=>{let a=t["image links"];if(a)for(let o=0;o<a.length;o++){let r=a[o].slice(a[o].lastIndexOf("-")+1).split(".")[0];if(0===o){let e=document.createElement("img");e.setAttribute("src",t["image links"][o]),n.querySelectorAll(".distinctImage")[o].querySelector(".imagetype").value=r,n.querySelectorAll(".distinctImage")[o].querySelector(".displayImage").appendChild(e)}else makeAddImage(n.querySelectorAll(".distinctImage")[0],r,t["image links"][o],n);o===a.length-1&&e()}}))}function eventOnAll(e,t){let n=document.querySelectorAll(e);for(let e=0;e<n.length;e++)n[e].addEventListener("change",(n=>{t(n,e)}))}function formatDate(e){let t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}function $(e){return document.querySelector(e)}function optData(e,t){return e.selectedIndex&&e.selectedIndex>0?t?e.options[e.selectedIndex].dataset[t]:e.options[e.selectedIndex].textContent:"default"}function setOption(e,t){e.querySelectorAll("option").forEach(((e,n)=>{e.textContent===t&&e.setAttribute("selected","selected")}))}function getOptionByValue(e,t){let n=e.querySelectorAll("option");for(var o=0;o<n.length;o++)if(n[o].textContent===t)return n[o]}function randomBytes(e){let t=new Uint32Array(e);window.crypto.getRandomValues(t);let n="";for(let e=0;e<t.length;e++)if(n+=t[e],e===t.length-1)return n}function characterCount(e,t,n){e.addEventListener("input",(e=>{let o=n-e.target.textContent.length;t.textContent=o,o>n?t.classList.add("alertdiv"):t.classList.contains("alertdiv")&&t.classList.remove("alertdiv")}))}function addTabIndex(e){let t=e.querySelectorAll(".tabindex");if(t)for(var n=0;n<t.length;n++)t[n].setAttribute("tabIndex",n.toString())}function nav(){document.querySelector(".navColapseBtn")&&(document.querySelector(".navColapseBtn").classList.add("scaled"),document.querySelector(".navColapseBtn").addEventListener("click",(function(e){document.querySelector(".navColapseDiv").style.height;"100%"===document.querySelector(".navColapseDiv").style.height?(e.target.classList.remove("navColapseBtnX"),document.querySelector(".navColapseDiv").style.height="0px"):(e.target.classList.add("navColapseBtnX"),document.querySelector(".navColapseDiv").style.height="100%")})))}function any(e,t){return e.includes(t)}function selectElementContents(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function scaleCaptcha(e){var t=document.querySelector("#inPageRecaptcha").width();if(304>t){var n=t/304;document.querySelectorALL(".g-recaptcha").forEach((function(e){e.style.transform="scale("+n+")"}))}}function clearchildren(e){for(var t=document.querySelector(e);t.firstChild;)t.removeChild(t.firstChild)}document.addEventListener("keydown",(e=>{"Space"===e.code&&"block"===document.querySelector(".alertmodal").style.display&&(e.preventDefault(),toggle.tog(".alertmodal","none"),e.stopPropagation()),"s"==e.key&&e.altKey&&(e.preventDefault(),document.querySelector("#viewstock").click()),"a"==e.key&&e.altKey&&(e.preventDefault(),document.querySelector("#addstock").click()),"s"==e.key&&e.shiftKey&&e.altKey&&(e.preventDefault(),document.querySelector("#sales").click()),"b"==e.key&&e.altKey&&(e.preventDefault(),document.querySelector("#blog").click()),"d"==e.key&&e.altKey&&(e.preventDefault(),document.querySelector(".toggleDocs").click())})),document.addEventListener("click",(e=>{e.target.classList.contains("question")&&(e.target.nextSibling.classList.add("infodisplay"),e.target.nextSibling.querySelector(".circle").addEventListener("click",(t=>{e.target.nextSibling.classList.remove("infodisplay")})))})),window.onload=nav();var swiftmoAlert={set:function(){return toggle.setinst(".alertmodal"),document.querySelector(".circleClose").addEventListener("click",(function(e){toggle.tog(".alertmodal","none"),e.stopPropagation()})),this},toggle:function(){return toggle.tog(".alertmodal"),this},setContent:function(e){return document.querySelector(".alertmodalcontentP").textContent=e,this},confirm:function(e){var t=document.createElement("button");t.textContent="confirm";var n=document.createElement("button");return n.textContent="cancel",document.querySelector(".alertmodalcontentP").append(t),document.querySelector(".alertmodalcontentP").append(n),t.addEventListener("click",(function(){swiftmoAlert.toggle(),e.iftrue()})),n.addEventListener("click",(function(){swiftmoAlert.toggle(),e.iffalse()})),this},swiftMoAffirm:function(){}};function SwiftmoAlert(){var e,t=new toggle,n=1;this.test=function(){alert("spin")},this.clear=function(e){return clearchildren(e),this},this.targetAndDeploy=function(n){return t.setinst(n),(e=document.createElement("p")).classList.add("alertdiv"),document.querySelector(n).appendChild(e),document.querySelector(n).style.display="none",this},this.message=function(t){return e.textContent=t,this},this.toggle=function(e){return++n%2==0?(t.tog(e,"block"),document.querySelector(e).scrollIntoView({block:"start",behavior:"smooth"}),window.setTimeout((function(){document.querySelector(e).classList.add("bounce","bounce-4")}),500)):t.tog(e,"none"),this}}function PercentInput(e){e.addEventListener("input",(e=>{let t=e.target.value.slice(0,e.target.value.length-1);if(t.includes("%"))e.target.value="%";else if(t.length>=3&&t.length<=4&&!t.includes("."))e.target.value=t.slice(0,2)+"."+t.slice(2,3)+"%",e.target.setSelectionRange(4,4);else if(t.length>=5&t.length<=6){let n=t.slice(0,2),o=t.slice(3,5);e.target.value=n+"."+o+"%"}else e.target.value=t+"%",e.target.setSelectionRange(e.target.value.length-1,e.target.value.length-1)}))}function getInt(e){let t=parseFloat(e);if(t%1==0)return t;{let e=t.toString().split(".").join("");return parseInt(e)}}function saveVideo(e){e.nextSibling.addEventListener("click",(function(t){t.preventDefault(),""===e.parentElement.parentElement.querySelector(".videolabel").value&&(e.parentElement.parentElement.querySelector(".videolabel").value="no label given");let n={timestamp:(new Date).getTime(),itemtype:"stock",label:e.parentElement.parentElement.querySelector(".videolabel").value,theme:document.querySelector("#select-theme").value,"item type":document.querySelector("#select-item_type").value,itemref:e.parentElement.dataset.itemref,video:e.files[0],producer:document.querySelector("#select-producer").value,tax:document.querySelector(".tax").value,price:document.querySelector(".price").value,special:document.querySelector(".special").checked},o=new FormData,a=Object.keys(n),r=Object.values(n);a.forEach((function(e,t){o.append(a[t],r[t])})),formxhr(o,"/backend/saveitemvideo",(function(t){let n=JSON.parse(t);if(n.error)swiftmoAlert.setContent(n.error).toggle();else{let t=document.createElement("div");t.style.display="flex";let o=document.createElement("video");o.setAttribute("src",n.link),o.setAttribute("autoplay",!0),o.style.maxWidth="100%",t.appendChild(o),e.parentElement.parentElement.querySelector(".videoDisplay").appendChild(t),swiftmoAlert.setContent(n.message).toggle(),o.scrollIntoView(!0)}}))}))}function xhr(e,t,n){afirm=!1;var o=new XMLHttpRequest;o.open("POST",t),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e)),1===o.readyState&&(document.body.style.pointerEvents="none"),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&o.responseText&&(n(o.responseText),document.body.style.pointerEvents="")}}function xhrget(e,t,n){var o=new XMLHttpRequest;o.open("GET",t),o.setRequestHeader("Content-Type","application/json"),o.timeout=1e3,o.send(encodeURI(e)),o.ontimeout=function(e){n("404")},o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText),o.status>=500&&o.status<600&&n("An error occurred, please wait a bit and try again."),404===o.status&&n("404")}}function formxhr(e,t,n){var o=new XMLHttpRequest;o.open("POST",t),o.send(e),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText),4===o.readyState&&500===o.status&&n(o.responseText)}}function asyncXHR(e,t,n){return new Promise((o=>{xhr(t,e,(function(e){if("noparse"===n)o(e);else{var t=JSON.parse(e);o(t)}}))}))}!function(){var e=[],t=[];toggle={tog:function(n,o){return"string"==typeof n?t[e.indexOf(n)]%2?document.querySelector(n).style.display=o||"block":document.querySelector(n).style.display="none":"object"==typeof n&&(t[e.indexOf(n)]%2?n.style.display=o||"block":n.style.display="none"),t[e.indexOf(n)]++,this},setinst:function(n){return!1===e.includes(n)?(e.push(n),t.push(1),this):this}}}();