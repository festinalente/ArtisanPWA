<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>SwiftMo Artistan Source: static/backend/SwiftCal/calendarConstructor.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">SwiftMo Artistan</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="backendEventDelegation.html">backendEventDelegation</a></li><li><a href="backendEventDelegation.mainMenu.html">backendEventDelegation.mainMenu</a></li><li><a href="backendEventDelegation.selectAndEdit.html">backendEventDelegation.selectAndEdit</a></li><li><a href="clientEventDelegation.html">clientEventDelegation</a></li><li><a href="clientEventDelegation.modalMethods.html">clientEventDelegation.modalMethods</a></li><li><a href="imagesAPI.html">imagesAPI</a></li><li><a href="module-Database%2520interaction-stockAPI.html">Database interaction~stockAPI</a></li><li><a href="SwiftCal.html">SwiftCal</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-Database%2520interaction.html">Database interaction</a></li><li><a href="module-multerFileUpload.html">multerFileUpload</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="CurrencyInput.html">CurrencyInput</a></li><li><a href="FuzzySearch.html">FuzzySearch</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="backendEventDelegation.html#.event:Addtheme">backendEventDelegation.event:Add theme</a></li><li><a href="backendEventDelegation.html#.event:Deleteimage">backendEventDelegation.event:Delete image</a></li><li><a href="backendEventDelegation.html#.event:Filtersthestockitemsonthepagebyitem">backendEventDelegation.event:Filters the stock items on the page by item</a></li><li><a href="backendEventDelegation.html#.event:Hidethenextrelevantcontent">backendEventDelegation.event:Hide the next relevant content</a></li><li><a href="backendEventDelegation.html#.event:Loginbuttonclick">backendEventDelegation.event:Login button click</a></li><li><a href="backendEventDelegation.html#.event:ResetFilters">backendEventDelegation.event:Reset Filters</a></li><li><a href="backendEventDelegation.html#.event:Showthenextrelevantcontent">backendEventDelegation.event:Show the next relevant content</a></li><li><a href="backendEventDelegation.html#.event:Stockaddapp.">backendEventDelegation.event:Stock add app.</a></li><li><a href="backendEventDelegation.selectAndEdit.Delete%2520a%2520thing,%2520e.g.html#.event:anitemtype">backendEventDelegation.selectAndEdit.Delete a thing, e.g.event: an item type</a></li><li><a href="backendEventDelegation.selectAndEdit.html#.event:Additemtype">backendEventDelegation.selectAndEdit.event:Add item type</a></li><li><a href="backendEventDelegation.selectAndEdit.html#.event:Addproducer">backendEventDelegation.selectAndEdit.event:Add producer</a></li><li><a href="backendEventDelegation.selectAndEdit.html#.event:Deleteitemtype">backendEventDelegation.selectAndEdit.event:Delete item type</a></li><li><a href="backendEventDelegation.selectAndEdit.html#.event:Editdimensions">backendEventDelegation.selectAndEdit.event:Edit dimensions</a></li><li><a href="backendEventDelegation.selectAndEdit.html#.event:Toggleeditmodal">backendEventDelegation.selectAndEdit.event:Toggle edit modal</a></li><li><a href="global.html#event:Clonesthespecifiednumberofaparticularitemtypewithaparticularpattern">event:Clones the specified number of a particular item type with a particular pattern</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#$">$</a></li><li><a href="global.html#addItemType">addItemType</a></li><li><a href="global.html#bookDay">bookDay</a></li><li><a href="global.html#dateOnClickEvents">dateOnClickEvents</a></li><li><a href="global.html#fieldCss">fieldCss</a></li><li><a href="global.html#generateTimesOnly">generateTimesOnly</a></li><li><a href="global.html#getArrayTypeInput">getArrayTypeInput</a></li><li><a href="global.html#Humandate">Human date</a></li><li><a href="global.html#makeDate">make Date</a></li><li><a href="global.html#makeQuestion">makeQuestion</a></li><li><a href="global.html#MakeScroller2">MakeScroller2</a></li><li><a href="global.html#makeTimeElements">makeTimeElements</a></li><li><a href="global.html#optData">optData</a></li><li><a href="global.html#range">range</a></li><li><a href="global.html#rangeSelect">rangeSelect</a></li><li><a href="global.html#releaseBookedDay">releaseBookedDay</a></li><li><a href="global.html#releaseDayOfWeekG">releaseDayOfWeekG</a></li><li><a href="global.html#removeTime()">removeTime()</a></li><li><a href="global.html#reqVal%2522requestvalidation%2522">reqVal "request validation"</a></li><li><a href="global.html#resetItemFields">resetItemFields</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: static/backend/SwiftCal/calendarConstructor.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
  * SwiftCal -Calendar app.
  * @namespace SwiftCal
  */
function SwiftCal() {
	var disabled = false,
		//things we use:
		datesSelectedArrayObjects = [],
		//dates chosen by end user (if any)
		endUserSelection = [],
		//simply tracks the above array:
		endUserSelectionTrackingArray = [],
		//strings, easier to compare:
		datesSelectedArray = [],
		selectRange,
		keyDay,
		calendar,
		timeChooserModal,
		saveAction,
		singleDaySelect,
		timeChooser,
		parentEl,
		clickCount = 1,
		displayTimeG = false,
		multipleRanges = [],
		activateMultipleRanges,
		question,
		questionAnswers = [],
		inst = 0,
		times = {
			indexes: [],
			values: []
		},
		time = {};

	//var preloadedDates = [{"day":"2018-11-28"},{"day":"2018-11-29"}];
	//TODO hook in save action on sensible events.
	//TODO auto order times chronologicaly -Done
	//TODO set in validator where start is less than end -Done
	//TODO set time rules rather times themselves (i.e. if 10:00 - 13:00  is selected for each monday, send just that not massive array)
	//Set alerts?
	/*Private Functions*/
	/**
	 * Book day
	 * @description Books a day by adding it to the datesSelectedArray and it's tracking array.
	 * @function bookDay
	 * @param day is a html div with an id that refers to the date YYYY-MM-DD months are counted from 0.
	 * @param date is a string YYYY-MM-DD months are counted from 0.
	 */
	function bookDay(day, date) {
		if (datesSelectedArray.includes(date) === false) {
			day.style.backgroundColor = '#fc3';
			datesSelectedArray.push(date);
			/*
			datesSelectedArrayObjects[datesSelectedArray.length - 1] = {
				day: date,
				humanDate: humandate(date)
			};*/
			datesSelectedArrayObjects.push({
				day: date,
				humanDate: humandate(date)
			});
		}
	}
	/**
	 * Releasee booked day
	 * @description removes a day that has been previously booked.
	 * @function releaseBookedDay
	 * @param day is a html div with an id that refers to the date YYYY-MM-DD months are counted from 0.
	 * @param date is a string YYYY-MM-DD months are counted from 0.
	 */
	function releaseBookedDay(day, date) {
		var index = datesSelectedArray.indexOf(date);
		day.style.backgroundColor = '#fff';
		datesSelectedArray.splice(1, index);
		datesSelectedArrayObjects.splice(1, index);
		if (day.children) {
			for (i = day.children.length - 1; i >= 0; i--) {
				day.children[i].remove();
			}
		}
	}
	/**
	 * Range select
	 * @description Allows a range of dates to be selected
	 * @function rangeSelect
	 * @todo allow range select to work with time values.
	 * @fires bookDay for each day in a range
	 */
	function rangeSelect() {
		var start = datesSelectedArrayObjects[0].day;
		var end = datesSelectedArrayObjects[1].day;

		var firstClicked = calendar.querySelector("[id='" + start + "']").dataset.dayindex;
		var secondClicked = calendar.querySelector("[id='" + end + "']").dataset.dayindex;

		//puts dates in the right order:
		if(firstClicked > secondClicked){
			datesSelectedArrayObjects.reverse();
		}

		//orders by index (a number, "day index")
		var lowestVal = function() {
			if (firstClicked - secondClicked > 0) {
				return [secondClicked, firstClicked];
			} else {
				return [firstClicked, secondClicked];
			}
		};

		var low = parseInt(lowestVal()[0]);
		var high = parseInt(lowestVal()[1]);

		for (var i = low; i &lt;= high; i++) {
			//best done via index as easilly itterable:
			var day = calendar.querySelector('[data-dayindex = "' + i + '"]');
			if (day.classList.contains('blocked')) {
				//sets last clicked element to white if it falls beyond a blocked data
				calendar.querySelector("[id='" + end + "']").style.backgroundColor = 'white';
				//removes it:
				datesSelectedArray.splice(1, 1);
				datesSelectedArrayObjects.splice(1, 1);
				break;
			}

			
			var date = day.id;
			var blockDay = calendar.querySelector("[id='" + date + "']");

			bookDay(blockDay, date);
			if (i === high) {
				//Place the dates in order:
				datesSelectedArray.push(datesSelectedArray.splice(1, 1)[0]);
				datesSelectedArrayObjects.push(datesSelectedArrayObjects.splice(1, 1)[0]);
				
			}
		}
	}
	/**
	 * Generate times only
	 * @description This simply generates a set of times on a particular date
	 * @function generateTimesOnly
	 * @param {?string[]} timeValues -An array of string representations of times ['09:00','12:00']
	 * @param {!HTMLElement] dayInPoint
	 */
	function generateTimesOnly(timeValues, dayInPoint) {
		var textinternal = '';
		if (dayInPoint.children) {
			for (i = dayInPoint.children.length - 1; i >= 0; i--) {
				dayInPoint.children[i].remove();
			}
		}
		if (timeValues &amp;&amp; timeValues.length > 0) {
			var ordered = sortTimes(timeValues);
			var index = datesSelectedArray.indexOf(dayInPoint.id);
			//Deep clone to remove original reference and create unique values:
			datesSelectedArrayObjects[index].times = JSON.parse(JSON.stringify(timeValues));
			//add time values to calendar
			ordered.forEach(function(e, i) {
				textinternal += e + ' ';
				var time = document.createElement('p');
				time.classList.add('calendarTime');
				time.style.marginBottom = '0px';
				time.textContent = textinternal;
				if (dayInPoint.classList.contains('filler') === false) {
					dayInPoint.style.backgroundColor = '#fc3';
					if (i % 2 === 1) {
						time.style.borderBottomStyle = 'solid';
						dayInPoint.appendChild(time);
						textinternal = '';
					} else {
						dayInPoint.appendChild(time);
						textinternal = '';
					}
				}
			});
		} else {
			return;
		}
	}

	function clearSelection() {
		
		datesSelectedArrayObjects.forEach(function(e, i) {
			document.getElementById(e.day).style.backgroundColor = '#fff';
			datesSelectedArrayObjects.splice(1, i);
			datesSelectedArray.splice(1, i);
		});
	};
	/**
	 * Release day of week
	 * @function releaseDayOfWeekG
	 * @param dayID id of the day to be released. N.b. day of week is stored as a data attribute
	 * @todo make it use keyDay (which is the day in context)
	 */
	function releaseDayOfWeekG(dayId) {
		//change dayId to key day
		var weekday = keyDay.dataset.dayofweek;
		var blockTheseDays = document.querySelectorAll("[data-dayofweek='" + weekday + "']");
		for (var i = 0; i &lt; blockTheseDays.length; i++) {
			var blockDay = document.getElementById(blockTheseDays[i].id);
			if (blockDay !== keyDay) {
				releaseBookedDay(blockDay, blockTheseDays[i].id);
				removeTimeDisplay(blockTheseDays[i].id);
			}
			if (blockDay === keyDay) {
				// remove only the display:
				//removeTimeDisplay(blockTheseDays[i].id);
			}
		}
	}

	function makeWhite(dayToWhite){
		for (var i = 0; i &lt; dayToWhite.length; i++) {
			if (!dayToWhite[i].classList.contains('blocked')) {
				dayToWhite[i].style.backgroundColor = 'white';
			}
		}
	}

	/** Date on click event
	 * @function dateOnClickEvents
	 * @param the event that fires this.
	 * @fires bookDay()
	 * @fires rangeSelect()
	 * @fires adjustPosition()
	 * @todo Write it so it selects elements by class and not by id. Remove ids completely actually. As in el.closest('#timeChooserModal');
	 */
	function dateOnClickEvents(e) {
		var el = e.target;
		keyDay = el;
		clickCount++;

		if (el.classList.contains('blocked')) {
			return;
		}

		if (calendar.querySelector('.makeTimeRuleGlobal')) {
			calendar.querySelector('.makeTimeRuleGlobalClass').textContent = dayText('Set these times for all ', 'days');
		}


		var day = el.dataset.day;
		var month = el.parentElement.parentElement.dataset.month;
		var year = el.parentElement.parentElement.dataset.year;
		var date = makeDate(year, month, day);

		if(singleDaySelect === true){
			datesSelectedArray.length = 0;
			datesSelectedArrayObjects.length = 0;
			makeWhite(document.getElementsByClassName('dayTime'));
			bookDay(el, date);
			return;
		}
		//no, go back
		if (disabled === true) {
			return;
		}
		//this deals only with ranges, if not returned the following code deals
		//with individual days.
		if (selectRange === true) {
			//multiple selections can be made by disabling this part of the code.
			//n.b. originaly bug meant this evaluated as true.
			switch(clickCount % 2){
				case 0:
					if(activateMultipleRanges){
						el.style.backgroundColor = '#fc3';
						bookDay(el, date);
						
					}
					if(question){
						
						questionModal.style.display = 'none';
					}
					if(!activateMultipleRanges &amp;&amp; !question){
						datesSelectedArray.length = 0;
						datesSelectedArrayObjects.length = 0;
						/*
						var dayToWhite = document.getElementsByClassName('dayTime');
						for(var i = 0; i &lt; dayToWhite.length; i++){
							
							if(!dayToWhite[i].classList.contains('blocked')){
								dayToWhite[i].style.backgroundColor = 'white';
							}
						}*/
						makeWhite(document.getElementsByClassName('dayTime'));
					}

					el.style.backgroundColor = '#fc3';
					bookDay(el, date);
					break;

				case 1:
					if(question){
						bookDay(el, date);
						rangeSelect();
						questionModal.style.display = 'block';
						//deep clone dates
						multipleRanges.push({dates: JSON.parse(JSON.stringify(datesSelectedArrayObjects))});
						//reset dates
						datesSelectedArray.length = 0;
						datesSelectedArrayObjects.length = 0;
					}
					if(!question){
						bookDay(this, date);
            rangeSelect();
					}
			}
			return;
		}
		//if date isn't preselected:
		if (datesSelectedArray.includes(date) === false) {
			if(timeChooser){
				var makeTimeRuleGlobal = timeChooser.querySelector('.makeTimeRuleGlobal');
				if (makeTimeRuleGlobal) {
					if (makeTimeRuleGlobal.checked === true) {
						bookDayOfWeekG(date, null);
					}
				}
			}
			bookDay(el, date);
			addTimeDisplay(date, null);
			//display time picker
			if (displayTimeG === true) {
				timeChooserModal.style.height = calendar.clientHeight + "px";
				timeChooserModal.style.width = calendar.clientWidth + "px";
				timeChooserModal.style.display = 'inline';
				adjustPosition(timeChooser, calendar);
			}
		} else {
			//this all deletes a day selectiong: n.b. not in separate function like range
			// select which just reset the entire selection pertaining to it.
			el.style.backgroundColor = 'white';
			datesSelectedArray.splice(datesSelectedArray.indexOf(date), 1);
			datesSelectedArrayObjects.splice(datesSelectedArray.indexOf(date), 1);
			//removes any time divs on deselect
			if (displayTimeG === true) {
				//n.b. children used to refer to nodes only, not elements.
				while (el.children[0]) {
					el.removeChild(el.children[0]);
				}
			}
		}
	}
	/* Helpful functions:
	 * gets month in JS ((monthNow + i + 1)% 12)
	 * gets days in month  getDaysInMonth(((monthNow + i + 1)% 12), new Date().addMonths(i).getFullYear())
	 * gets month in human new Date().addMonths(i).getFullYear())
	 * gets year new Date().addMonths(i).getFullYear())
	 * get first day of month new Date(new Date().addMonths(i).getFullYear()), ((monthNow + i + 1)% 12));
	 */
	/**
	 * var getDaysInMonth - Get number of days in month
	 *
	 * @param  {!number} month The number of the corresponding month.
	 * @param  {!number} year  The corresponding year.
	 * @return {number} Returns a number corresponding to the number of days for the date in point.
	 */
	var getDaysInMonth = function(month, year) {
		return new Date(year, month, 0).getDate();
	};
	/**
	 * @memberof Date
	 * @param months to add;
	 * @description adds months to a date, (e.g. 2019-10-20 + 4 months) = 2020-2-20;
	 */
	Date.prototype.addMonths = function(m) {
		var d = new Date(this);
		var years = Math.floor(m / 12);
		var months = m - years * 12;
		if (years) d.setFullYear(d.getFullYear() + years);
		if (months) d.setMonth(d.getMonth() + months);
		return d;
	};
	/** Amount of months between two dates:
	 * @param d1 {!date}
	 * @param d2 {!date}
	 */
	function monthsFrom(d1, d2){
	  var months;
	  months = (d2.getFullYear() - d1.getFullYear()) * 12;
	  months -= d1.getMonth();
	  months += d2.getMonth();
	  return months;
	}
	/** Make date
	 * @function make Date
	 * @param year -4 digit year
	 * @param month -2 digit month
	 * @param day -2 digit day
	 * @description returns a sting representation of a day e.g.: '2019-10-04'
	 */
	function makeDate(year, month, day) {
		var date = year + '-' + month + '-' + day;
		return date;
	}
	/** Human date
	 * @function Human date
	 * @param date -'2019-10-04'
	 * @description Adds a 1 to the month in a date to make it comprehensible by humans.
	 */
	function humandate(date) {
		var humanDateSplit = date.split('-');
		var humanDate = humanDateSplit[0] + '-' + (parseInt(humanDateSplit[1]) + 1) + '-' + humanDateSplit[2];
		return humanDate;
	}
	/** Make button
	 * @description re write of a lost function that makes a little circular button with a letter of symbol in it. It passes the click event along to the function that is assigned to handle it.
	 * @param parent The parent element you wish to attach the parent to.
	 * @param id The id you wish the button to have.
	 * @param character The caracter you wish the button to have (e.g. +, -, x);
	 * @param title The title attribute for the button
	 * @param fn The function you wish to be called on button click
	 * @todo Make so various actions can be applied rather than just click.
	 */
	function makeButton(parent, id, character, title, fn) {
		var base = document.createElement('p');
		base.id = id;
		base.textContent = character;
		parent.appendChild(base);
		base.title = title
		base.classList.add('deleteButton');
		base.addEventListener('click', function(e) {
			fn(e)
		});
	}
	/** Block a particular day of the week (e.g. sabath)
	 * @description Takes a sample day (e.g. 2019-10-20), gets the day of week via data attribute and block all other days with this attribute value
	 * @param string dayId The ID of the sample day e.g. '2019-12-10'
	 * @param inst number The instance if not using globally defined instance.
	 */
	function bookDayOfWeekG(dayId) {
		var weekday = document.getElementById(dayId).dataset.dayofweek;
		var blockTheseDays = document.querySelectorAll("[data-dayofweek='" + weekday + "']");
		blockTheseDays.forEach(function(e, i) {
			if (e.classList.contains('filler') === false) {
				var day = document.getElementById(e.id);
				bookDay(day, e.id);
				addTimeDisplay(e.id);
				if (i === blockTheseDays.length - 1) {}
			}
		});
	}
	/**
	 * close modal
	 * @funtion closeModal()
	 * @desctription Closes the time chooser modal then resets times
	 */
	function closeModal(e) {
		if(question){
			questionAnswers.push(calendar.querySelector('input.question').value);
		}

		var all = calendar.querySelectorAll('.dayTime');
		/*all.forEach(function(el) {
			//this is a very hacky way of adding a range of dates on modal close by simulating a click event on each.
			// this should be a full separate fuction that doesn't touch event. this is why clickCount--
			if (e.style.backgroundColor === 'rgb(255, 204, 51)' &amp;&amp; e.children.length === 0) {
				el.click();
				clickCount--;
			}
		});*/
		if (times.values % 2 === 1) {
			if (swiftmoAlert) {
				swiftmoAlert.setContent('Warning, you\'re missing an end time for the last time gap you entered.').toggle();
			}
			return;
		} else if (times.values.length === 0) {
			calendar.querySelector('.timeChooserModal').style.display = 'none';
		} else if (timeValueInMill(times.values[times.values.length - 1]) &lt; timeValueInMill(times.values[times.values.length - 2])) {
			if (swiftmoAlert) {
				swiftmoAlert.setContent('Warning, you\'ve entered an end time which is before the start time.').toggle();
			}
			return;
		} else if (checkOverlap(times.values) === false) {
			if (swiftmoAlert) {
				swiftmoAlert.setContent('Warning, that time overlaps with other times you\'ve already selected.').toggle();
			}
		} else {
			calendar.querySelector('.timeChooserModal').style.display = 'none';
		}
	}

	function timeValueInMill(time) {
		var br = time.split(':');
		return parseInt(br[0]) * 60 * 60 * 1000 + parseInt(br[1]) * 60 * 1000;
	}

	function sortTimes(val) {
		var sorted = [];
		return enumerate(val);

		function sortNumber(a, b) {
			return a - b;
		}

		function enumerate(values) {
			var numericalEquivalent = [];
			for (var i = 0; i &lt; values.length; i++) {
				numericalEquivalent.push(timeValueInMill(values[i]));
				if (i === values.length - 1) {
					return sort(values, numericalEquivalent);
				}
			}
		}

		function sort(values, numericalEquivalent) {
			var numericalEquivalentClone = JSON.parse(JSON.stringify(numericalEquivalent));
			var sortedInt = numericalEquivalent.sort(sortNumber);
			for (var p = 0; p &lt; numericalEquivalentClone.length; p++) {
				var newIndex = sortedInt.indexOf(numericalEquivalentClone[p]);
				sorted.splice(p, 1, values[newIndex]);
				if (p === numericalEquivalent.length - 1) {
					return sorted;
				}
			}
		}
	}

	function checkOverlap(values) {
		var numericalEquivalent = [];
		var overlap = false;
		if (values.length % 2 === 0) {
			for (var i = 0; i &lt; values.length; i++) {
				numericalEquivalent.push(timeValueInMill(values[i]));
			}
		}
		for (var ii = 0; ii &lt; numericalEquivalent.length; ii++) {
			if (ii >= 2 &amp;&amp; ii % 2 === 0) {
				var st = numericalEquivalent[ii];
				var en = numericalEquivalent[ii + 1];
				for (var h = 0; h &lt; numericalEquivalent.length; h++) {
					//don't compare to self
					if (h % 2 === 0 &amp;&amp; ii !== h) {
						var st2 = numericalEquivalent[h];
						var en2 = numericalEquivalent[h + 1];
						if (en2 > st &amp;&amp; en2 &lt; en) {
							return false;
						} else if (st > st2 &amp;&amp; en &lt; en2) {
							return false;
						} else if (st === st2 &amp;&amp; en === en2) {
							return false;
						} else if (en > st2 &amp;&amp; en &lt; en2) {
							return false;
						} else {
							return true;
						}
					}
				}
			}
		}
	}

	function removeTimeDisplay(dayInPoint) {
		if (!dayInPoint) {
			dayInPoint = document.getElementById(datesSelectedArrayObjects[datesSelectedArrayObjects.length - 1].day);
		} else {
			dayInPoint = document.getElementById(dayInPoint);
		}
		for (i = dayInPoint.children.length; i >= 0; i--) {
			if (dayInPoint.children[i]) {
				dayInPoint.children[i].remove();
			}
		}
	}
	/**
	 * Remove time(chooser div)
	 * @function removeTime()
	 * @description removes the last time chooser and times made
	 */
	function removeTime() {
		/*if there's more than one picker, this can be got several ways:
		 * calendar.querySelectorAll('.timeChooser').length;
		 * document.querySelector('#shopTimeTable').querySelectorAll('.timePickerContainer').length
		 * removeOrRestTimePicker
		 */
		var timeChooser = calendar.querySelector('.timeChooser');
		var makeTimeRuleGlobal = timeChooser.querySelector('.makeTimeRuleGlobal');
		var timePickerContainers = calendar.querySelectorAll('.timePickerContainer');
		//remove one or two times depending:
		if (timePickerContainers.length >= 2) {
			timeChooser.removeChild(timePickerContainers[timePickerContainers.length - 1]);
			//remove times from the array
			if (times.indexes.length % 2 === 0) {
				times.indexes.splice(times.indexes.length - 2, 2);
				times.values.splice(times.values.length - 2, 2);
			}
			//redundant?:
			else {
				times.indexes.splice(times.indexes.length - 1, 1);
				times.values.splice(times.values.length - 1, 1);
			}
			generateTimesOnly(times.values, keyDay);
		} else {
			timeChooser.querySelectorAll('select').forEach(function(e) {
				e.selectedIndex = 0;
			});
			//document.getElementsByClassName(times.indexes[i] + '-hh')[0].selectedIndex = 0;
			//document.getElementsByClassName(times.indexes[i] + '-mm')[0].selectedIndex = 0;
			if (times.indexes.length % 2 === 0) {
				times.indexes.splice(times.indexes.length - 2, 2);
				times.values.splice(times.values.length - 2, 2);
			}
			//redundant?:
			else {
				times.indexes.splice(times.indexes.length - 1, 1);
				times.values.splice(times.values.length - 1, 1);
			}
			makeTimeRuleGlobal.checked = false;
			generateTimesOnly(times.values, keyDay)
			if (calendar.querySelector(keyDay.id).children.length === 0) {
				keyDay.click();
			}
			//releaseDayOfWeekG(keyDay.id);
			//releaseBookedDay(keyDay, keyDay.id);
			//generateTimesOnly(times.values, keyDay);
		}
		if (makeTimeRuleGlobal.checked === true) {
			//makeTimeRuleGlobal.checked = false;
			// resets all dates with the correct time
			//releaseDayOfWeekG(keyDay.id);
			bookDayOfWeekG(keyDay.id, inst);
		}
		//just the key day:
		else {
			releaseDayOfWeekG(keyDay.id);
		};
	}
	/**
	 * Make time element
	 * @function makeTimeElements
	 * @param {HTMLElement} div
	 * @returns A div in the modal with a time selector
	 */
	function makeTimeElements(calendar) {
		//Base:
		timeChooserModal = document.createElement('div');
		timeChooserModal.classList.add('timeChooserModal');
		//timeChooserModal.id = 'timeChooserModal';
		calendar.appendChild(timeChooserModal);
		var timeCont = document.createElement('div');
		timeCont.classList.add('timeCont');
		timeChooserModal.appendChild(timeCont);
		timeChooserModal.addEventListener('click', function(e) {
			if (e.target.classList.contains('timeChooserModal') === false) {
				return;
			} else {
				closeModal(e);
			}
		})
		timeChooser = document.createElement('div');
		timeChooser.classList.add('timeChooser');
		timeCont.appendChild(timeChooser);
		var deleteDiv = document.createElement('div');
		deleteDiv.classList.add('deleteDiv');
		//makeButton(parent, id, character, title, fn)
		makeButton(deleteDiv, 'addTime', '+', 'add a time', innerComponents);
		makeButton(deleteDiv, 'removeTime', '-', 'remove last time', removeTime);
		makeButton(deleteDiv, 'deleteButton', 'x', 'close', closeModal);
		timeChooser.appendChild(deleteDiv);
		return this;
	};

	/**
	 * Make question element
	 * @function makeQuestion
	 * @param {HTMLElement} div
	 * @returns A div in the modal with a text field
	 */
	function makeQuestion(calendar, questions) {
		//Base:
		//
		
				questionModal = document.createElement('div');
				questionModal.classList.add('timeChooserModal');
				calendar.appendChild(questionModal);

		var questionCont = document.createElement('div');
				questionCont.classList.add('timeCont');

				questionModal.appendChild(questionCont);

		questionModal.addEventListener('click', function(e) {
			if (e.target.classList.contains('timeChooserModal') === false) {
				return;
			}
			else {
				closeModal(e);
			}
		});

		var question = document.createElement('div');
				question.classList.add('timeChooser');
				questionCont.appendChild(question);

		var deleteDiv = document.createElement('div');
				deleteDiv.classList.add('deleteDiv');


		makeButton(deleteDiv, 'deleteButton', 'x', 'close', closeModal);
				question.appendChild(deleteDiv);


		var questionDiv = document.createElement('div');
				question.appendChild(questionDiv);

		questions.forEach(function(e, i){
			var p = document.createElement('p');
			questionDiv.appendChild(p);
			p.classList.add('question');
			p.textContent = e;

			var textbox = document.createElement('input');
			textbox.setAttribute('type', 'text');
			textbox.setAttribute('name', 'question');
			textbox.classList.add('question');
			questionDiv.appendChild(textbox);
		});

		return this;
	};
	//(makeTimeElements calls) -> (makebutton attaches closeModal
	/**
	 * innerComponents - description
	 *
	 * @return {type}  description
	 */
	function innerComponents() {
		//If the current elements aren't filled:
		if (calendar.querySelectorAll('.timePickerContainer').length * 2 !== times.values.length) {
			if (swiftmoAlert) {
				swiftmoAlert.setContent('Fill in the current time values before adding another.').toggle();
			} else {
				alert('Fill in the current time values before adding another.');
			}
			return;
		}
		var timePickerContainer = document.createElement('div');
		timePickerContainer.classList.add('timePickerContainer');
		timeChooser.appendChild(timePickerContainer);
		var deleteDiv = document.createElement('div');
		deleteDiv.textContent = 'Add time:';
		deleteDiv.classList.add('deleteDiv');
		timePickerContainer.appendChild(deleteDiv);
		var instInternal = inst;
		maketime('Start', timePickerContainer, instInternal);
		maketime('End', timePickerContainer, instInternal);
		tickboxes(timePickerContainer);
		inst++;
	}

	function scrollToTimePicker() {
		var nodes = document.querySelectorAll('.timePickerContainer');
		nodes[nodes.length - 1].scrollIntoView({
			behavior: "smooth",
			block: "end",
			inline: "nearest"
		});
	}

	function dayText(textbefore, textafter, dow) {
		//day of week
		if (!dow) {
			dow = parseInt(keyDay.dataset.dayofweek);
		}
		var daysInFull = ['Sun', 'Mon', 'Tues', 'Wednes', 'Thurs', 'Fri', 'Satur'];
		return textbefore + daysInFull[dow] + textafter;
	}
	/**
	 * tickboxes - description
	 *
	 * @param  {HTMLElement} timePickerContainer This is the HTML element to which the checkbox will be appended.
	 * @return {HTMLElement} Returns a HTML checkbox to select all days of a particular type (e.g. all Mondays).
	 */
	function tickboxes(timePickerContainer) {
		var timeCont = timePickerContainer;
		var labelfor = document.createElement('p');
		var text = dayText('Set these times for all ', 'days');
		if (inst === 0) {
			labelfor.textContent = text;
			labelfor.classList.add('timeSelectP', 'makeTimeRuleGlobalClass');
			labelfor.htmlFor = 'makeTimeRuleGlobal'
			timeCont.appendChild(labelfor);
			var makeTimeRuleGlobal = document.createElement('input');
			makeTimeRuleGlobal.setAttribute('type', 'checkbox');
			makeTimeRuleGlobal.name = 'makeTimeRuleGlobal';
			makeTimeRuleGlobal.classList.add('makeTimeRuleGlobal');
			timeCont.appendChild(makeTimeRuleGlobal);
			makeTimeRuleGlobal.addEventListener('click', function(e) {
				if (makeTimeRuleGlobal.checked === false) {
					releaseDayOfWeekG(keyDay.id);
				} else {
					bookDayOfWeekG(keyDay.id, inst);
				}
			});
			scrollToTimePicker()
		} else {
			labelfor.textContent = dayText('Set these times for all ', 'days');
			scrollToTimePicker()
			return;
		}
	}

	function maketime(startEnd, appendTo, instInternal) {
		var startContainer = document.createElement('div');
		startContainer.classList.add('timeContainer');
		var startLabel = document.createElement('p');
		//startLabel.setAttribute('for', startEnd+'Hour');
		startLabel.classList.add('timeSelectP');
		startLabel.textContent = startEnd + ':';
		startContainer.appendChild(startLabel);
		var hourSelect = document.createElement('div');
		hourSelect.id = startEnd + '-' + instInternal;
		if (instInternal) {
			hourSelect.classList.add(instInternal);
		}
		hourSelect.classList.add('hour', 'times', startEnd);
		startContainer.appendChild(hourSelect);
		makeSelector('hh', 24, hourSelect.id, hourSelect, startEnd, instInternal);
		makeSelector('mm', 59, hourSelect.id, hourSelect, startEnd, instInternal);
		appendTo.appendChild(startContainer);
	}

	function makeSelector(type, limit, id, parent, startEnd, instInternal) {
		time[type] = '00';
		var h = document.createElement('select');
		h.classList.add(type, id + '-' + type, 'timeSelect');
		var i = 0;
		var placeholder = document.createElement('option');
		placeholder.textContent = type;
		placeholder.value = '00';
		h.appendChild(placeholder);
		while (i &lt;= limit) {
			var hour = document.createElement('option');
			//leading zero on single digit numbers:
			var text = i.toString();
			if (text.length === 1) {
				text = '0' + i;
			}
			hour.value = text;
			hour.textContent = text;
			h.appendChild(hour);
			i++;
		}
		h.addEventListener('click', function() {
			time[type] = h.value;
			if (type === 'hh') {
				time.mm = '00';
				h.nextSibling.selectedIndex = '1';
			}
			if (!times.indexes.includes(startEnd + '-' + instInternal)) {
				times.indexes.push(startEnd + '-' + instInternal);
				times.values.push(time.hh + ':' + time.mm);
			} else {
				var index = times.indexes.indexOf(startEnd + '-' + instInternal);
				times.values[index] = time.hh + ':' + time.mm;
			}
			addTimeDisplay(null);
		});
		parent.appendChild(h);
	}

	function adjustPosition(element, targetCalendar) {
		//position Time picker:
		var calCoordinates = targetCalendar.getBoundingClientRect();
		var x = calCoordinates.x;
		var y = calCoordinates.y;
		var calWidth = calCoordinates.width;
		var timeChooserCoordinates = element.getBoundingClientRect();
		var tWidth = timeChooserCoordinates.width;
		//var topCo = y + 50;
		var topCo = y + 10;
		var leftCo = x + ((calWidth - tWidth) / 2);
		element.style.top = topCo + "px";
		element.style.left = leftCo + "px";
	}

	function addTimeDisplay(dayInPoint) {
		if (dayInPoint === null) {
			if (calendar.querySelector('.makeTimeRuleGlobal').checked === true) {
				bookDayOfWeekG(keyDay.id);
			} else {
				generateTimesOnly(times.values, keyDay);
			}
		}
		if (dayInPoint) {
			generateTimesOnly(times.values, calendar.querySelector("[id='" + dayInPoint + "']"));
		}
	}

	this.singleDaySelect = function(boolean) {
		singleDaySelect = boolean;
		

		return this
	}

	this.collectEndUserSelection = function() {
		return endUserSelection;
	};
	//if set runs a function everytime a time is selected, or dates added via day of week or when the timepicker is closed:
	// not finished
	this.setSaveAction = function(save) {
		saveAction = save;
		return this;
	}
	this.datesSelected = function() {
		return datesSelectedArrayObjects;
	};
	this.showTimes = function() {
		return times;
	};
	this.datesSelectedTracker = function() {
		return datesSelectedArray;
	};
	this.returnMultipleRanges = function(){
		return multipleRanges;
	};
	this.activateMultipleRanges = function(boolean){
		
		activateMultipleRanges = boolean;
		return this;
	};
	this.questionAnswers = function(){
		return questionAnswers;
	};

	this.setDateInformation = function(cal, targetDays, message){
		setDateInformation(cal, targetDays, message);
		return this;
	}

	/**
	 * @description This basically posts a number to a date corresponding
	 * to the number of jobs on a particular day takes the form
	 * [{day: "2020-7-14", jobcount: '1' }] where months are countent from zero.
	 */
	function setDateInformation(cal, targetDays, message){
		
		var alldays = document.querySelector(cal).querySelectorAll('.dayTime');
		//cleans the calendar of info after each selection:
		for(j = 0; j &lt; alldays.length; j++){
			if(alldays[j].firstElementChild &amp;&amp; alldays[j].firstElementChild.textContent){
			   alldays[j].removeChild(alldays[j].querySelector('.calendarTime'));
			}
		}
		for (i = 0; i &lt; targetDays.length; i++) {
			var dateId = document.querySelector(cal).querySelector("[id='" + targetDays[i].day + "']");
			if (dateId !== null &amp;&amp; dateId.classList.contains('filler') === false) {
				var jobcount = (dateId.firstElementChild &amp;&amp; dateId.firstElementChild.textContent) ? parseInt(dateId.firstElementChild.textContent.match(/\d+/g).map(Number)) + 1 : 1;
					
						dateId.title = jobcount + ' jobs on this day';

				function makeel(){
					
					var jobP = document.createElement('p');
							jobP.classList.add('calendarTime');
							//plural
							jobP.textContent = (jobcount === 1) ? jobcount + ' ' + message : jobcount + ' ' + message + 's';
					dateId.appendChild(jobP);
				}

				function writetoel(){
					
					dateId.firstElementChild.textContent = (jobcount === 1) ? jobcount + ' ' + message : jobcount + ' ' + message + 's';
				}

				(dateId.firstElementChild) ? writetoel() : makeel();

			}
		}
	}

	this.clearSelection = function() {
		return clearSelection();
	};

	this.disable = function() {
			disabled = true;
		},
		/**
		 * rangeOption - description
		 *
		 * @param  {type} boolean description
		 * @return {type}         description
		 */
		this.range = function rangeOption(boolean) {
			selectRange = boolean;
			return this;
		};

		this.parentEl = function returnParent(){
			return parentEl;
		}

	/**
	 * Make calendar
	 * @function makeCalendar
	 * @description Call this function passing a css selector or the element itself.
	 * @memberof SwiftCal
	 * @param {!(string|HTMLElement)} parentEl - The HTML elemen you wish to attach the calendar to. Required.
	 * @param {?string[]} preloadedDates - Array Dates you wish to display on the calendar or null
	 * @param {number} [n=4]preloadedDates - Number Number of months to display or defaults to 4
	 * @param {?boolean} displayTime - Boolean displays time option, defaults to false
	 * @param {?boolean} endUser - Boolean, Limits function to an end user (i.e. client of a client)
	 * @param {?string[]} n - endUserDurationChoice Array, loads dates provided by an end user.
	 * @param {?boolean} backend - Boolean Makes available backend functionality.
	 * @param {?string} startDate - E.g. '2019-09-01' YYYY-MM-DD
	 */
	this.calendar = function makeCalendar(
		/*1*/parentEl,
		/*2*/preloadedDates,
		/*3*/numberOfMonthsToDisplay,
		/*4*/displayTime,
		/*5*/endUser,
		/*6*/endUserDurationChoice,
		/*7*/backend,
		/*8*/startDate,
		/*9*/makequestion) {
		
		//Calendar is defined globally within the constructor
		parentEl = (typeof parentEl === 'string') ? document.querySelector(parentEl) : parentEl;

		calendar = document.createElement('div');
		calendar.classList.add('calendar');
		parentEl.appendChild(calendar);

		if (displayTime === true) {
			displayTimeG = true;
			makeTimeElements(calendar);
		}

		if(makequestion){
			question = true;
			makeQuestion(calendar, makequestion);
		}

		var dateNow = function(){
			if(startDate){
				return new Date(startDate);
			}else{
				return new Date();
			}
		}

		function attach(elem) {
			elem.addEventListener('click', function() {
				if (endUserSelectionTrackingArray.includes(elem.id)) {
					elem.style.borderStyle = 'none';
					endUserSelection.splice(endUserSelectionTrackingArray.indexOf(elem.id), 1);
					endUserSelectionTrackingArray.splice(endUserSelectionTrackingArray.indexOf(elem.id), 1);
				} else {
					elem.style.borderStyle = 'solid';
					elem.style.borderColor = 'blue';
					var timeConstraint = elem.children[0].textContent.split(' ');
					//min should be user defined by the guide in a data attribute:
					var min = 1;
					var max = parseInt(timeConstraint[1]) - parseInt(timeConstraint[0]);
					var times = document.getElementById(elem.id).firstChild.nextSibling.textContent;
					endUserSelection.push({
						day: elem.id,
						duration: min,
						timeGap: times,
						humanDate: humandate(elem.id)
					});
					endUserSelectionTrackingArray.push(elem.id);
					//toggle duration
					if (endUser === true &amp;&amp; endUserDurationChoice === true) {
						toggleDuration(elem.id, min, max);
						adjustPosition('durationChooser', calendar);
						document.addEventListener('click', function(event) {
							var isClickInside = document.getElementById('durationInput').contains(event.target);
							if (isClickInside) {
								saveClientDateDuration();
							}
							if (!isClickInside &amp;&amp; event.target === document.getElementById('durationChooserModal')) {
								document.getElementById('durationChooserModal').style.display = 'none';
								saveClientDateDuration();
							}
						});
					}
				}
			});
		}

		function durationChooser() {
			var modal = document.createElement('div');
			modal.classList.add('timeChooserModal');
			modal.id = 'durationChooserModal';
			var durationChooser = document.createElement('div');
			durationChooser.classList.add('timeChooser');
			durationChooser.id = 'durationChooser';
			modal.appendChild(durationChooser);
			calendar.appendChild(modal);
			var deleteDiv = document.createElement('div');
			deleteDiv.textContent = 'Duration:';
			deleteDiv.classList.add('deleteDiv');
			durationChooser.appendChild(deleteDiv);
			makeButton(deleteDiv, 'deleteButton', 'x', 'close', closeModal);
			var Container = document.createElement('div');
			Container.classList.add('timeContainer');
			var Label = document.createElement('label');
			Label.setAttribute('id', 'calendarLabel');
			Label.setAttribute('for', 'hourSelect');
			Label.textContent = 'hours:';
			Container.appendChild(Label);
			var hourSelect = document.createElement('input');
			hourSelect.setAttribute('type', 'number');
			hourSelect.id = 'durationInput';
			hourSelect.classList.add('hour');
			Container.appendChild(hourSelect);
			durationChooser.appendChild(Container);
		}

		function toggleDuration(day, min, max) {
			document.getElementById('durationInput').setAttribute('min', min);
			document.getElementById('durationInput').setAttribute('max', max);
			document.getElementById('durationInput').value = '1';
			document.getElementById('durationChooserModal').style.height = calendar.clientHeight + "px";
			document.getElementById('durationChooserModal').style.width = calendar.clientWidth + "px";
			document.getElementById('durationChooserModal').style.display = 'inline';
		}

		function saveClientDateDuration() {
			var duration = document.getElementById('durationInput').value;
			endUserSelection[endUserSelection.length - 1].duration = duration;
		}

		//afterCalendarInit CALL SwiftCal() range before instantiating the caledar
		function preloadDatesFn(calendar, dates) {

			if (dates) {
				//Assign dates to datesSelectedArrayObjects.
				datesSelectedArrayObjects = dates;
				for (var i = 0; i &lt; dates.length; i++) {
					//Hacky way to get the id with an interger as a first character:
					var dateId = "[id='" + dates[i].day + "']";
					//Make sure element exists in the calendar
					//Query selector is used to search a specified calendar and not the dom in general:
					if (calendar.querySelector(dateId) !== null) {

						//Fill the tracking array:
						datesSelectedArray.push(dates[i].day);
						calendar.querySelector(dateId).style.backgroundColor = '#fc3';
						calendar.querySelector(dateId).classList.add('available');
						//endUser option with durations!
						if (endUser === true) {
							attach(calendar.querySelector(dateId));
							//end user duration Chooser, rest of code at top of file
							durationChooser();
						}
						if (displayTimeG === true) {
							generateTimesOnly(dates[i].times, calendar.querySelector(dateId));
						}
						//selectRange === true &amp;&amp;b
						if ( calendar.querySelector(dateId) !== null &amp;&amp; calendar.querySelector(dateId).classList.contains(
							'filler') === false &amp;&amp; !backend) {
							//use preloaded dates directly blocked.push(preloadedDates[i].day);
							calendar.querySelector(dateId).style.backgroundColor = '#333';
							calendar.querySelector(dateId).classList.add('blocked');
							calendar.querySelector(dateId).title = 'No availability on this day';
							var soldOut = document.createElement('p');
							soldOut.classList.add('calendarTime');
							soldOut.textContent = 'Sold out';
							calendar.querySelector(dateId).appendChild(soldOut);
						}
						if ( calendar.querySelector(dateId) !== null &amp;&amp; calendar.querySelector(dateId).classList.contains(
							'filler') === false &amp;&amp; backend) {
							//use preloaded dates directly blocked.push(preloadedDates[i].day);
							calendar.querySelector(dateId).style.backgroundColor = '#fc3';
							calendar.querySelector(dateId).classList.add('blocked');
							calendar.querySelector(dateId).title = 'Times';
						}
					}
				}
			} else {
				return;
			}
		}
		if (numberOfMonthsToDisplay === undefined) {
			numberOfMonthsToDisplay = 4;
		}
		if(startDate){
			numberOfMonthsToDisplay = monthsFrom(dateNow(), new Date()) + 1;
		}
		if (backend === true) {
			var dayblock = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
			var dayblockrow = document.createElement('div');
			dayblockrow.classList.add('dayblockrow');
			var title = document.createElement('h4');
			title.textContent = 'Select days of week to block:';
			dayblockrow.appendChild(title);
			dayblock.forEach(function(e, i) {
				var input = document.createElement('input');
				input.setAttribute('type', 'checkbox');
				input.classList.add('block');
				input.name = e;
				input.dataset.block = dayblock.indexOf(e);
				dayblockrow.appendChild(input);
				var label = document.createElement('label');
				label.for = e;
				label.textContent = e;
				dayblockrow.appendChild(label);
			});
			calendar.appendChild(dayblockrow);
			//FUNCTION FOR BLOCKING ALL DAYS OF A TYPE:
			if (backend) {
				var daysToBlock = document.getElementsByClassName('block');
				for (i = 0; i &lt; daysToBlock.length; i++) {
					daysToBlock[i].addEventListener('click', function(e) {
						var blockTheseDays = document.querySelectorAll("[data-dayofweek='" + e.target.dataset.block + "']");
						if (e.target.checked) {
							for (i = 0; i &lt; blockTheseDays.length; i++) {
								blockTheseDays[i].classList.add('widthShape', 'filler');
							}
						} else {
							for (i = 0; i &lt; blockTheseDays.length; i++) {
								blockTheseDays[i].classList.remove('filler');
							}
						}
					});
				}
			}
		}
		var months = [];

		var monthNow = dateNow().getMonth();
		var yearNow = dateNow().getFullYear();
		var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		//This basically just gives each day a unique index to make for easier
		//comparison. Useless outside this context.
		var uniqueDayIndex = 0;
		//make months
		for (var i = 0; i &lt; numberOfMonthsToDisplay; i++) {
			months.push(document.createElement('div'));
			calendar.appendChild(months[i]);
			months[i].style.width = '19em';
			months[i].style.backgroundColor = '#f15925';
			months[i].classList.add('month');
			//make month name
			var month = document.createElement('div');
			month.textContent = monthNames[(monthNow + i) % 12];
			month.classList.add('monthName');
			months[i].appendChild(month);
			//make week row
			var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
			var weekrow = document.createElement('div');
			weekrow.classList.add('weekrow');
			months[i].appendChild(weekrow);
			days.forEach(function(e) {
				var day = document.createElement('div');
				weekrow.appendChild(day);
				day.textContent = e;
				day.classList.add('dayName', 'widthShapeDays');
			});
			//make days:
			var pegholes = [];
			var weekrow1 = document.createElement('div');
			months[i].appendChild(weekrow1);
			weekrow1.classList.add('weekrow');
			//Days and date information
			var yearCalc = dateNow().addMonths(i).getFullYear();
			var monthCalc = (monthNow + i) % 12;
			var startDayOfMonth = new Date(yearCalc, monthCalc).getDay();
			var datenow = dateNow().getDate();
			var daysinMonth = getDaysInMonth(
				(monthNow + i + 1) % 12, new Date().addMonths(i).getFullYear());
				
			months[i].dataset.year = yearCalc;
			months[i].dataset.month = monthCalc;
			months[i].id = monthCalc + '-' + yearCalc;
			//Day count:
			var count = 1;
			var dayofweek = 0;
			//p accounts for "spilage" off days into incomplete weeks (6 therefore 42 slots, some empty).
			for (p = 0; p &lt;= 41; p++) {
				if (p &lt; startDayOfMonth) {
					pegholes.push(document.createElement('div'));
					pegholes[p].classList.add('widthShape', 'filler');
					weekrow1.appendChild(pegholes[p]);
					pegholes[p].style.backgroundColor = 'white';
					//pegholes[p].dataset.dayofweek = dayofweek;
					dayofweek++;
				}
				//New edit. Blocks past dates in month 0. Make it an option to select past dates?
				//i referes to month (current month) the limit at the end is date now, plus the empty
				//boxes at the start of the month, minus one to give today as available
				if (i === 0 &amp;&amp; p >= startDayOfMonth &amp;&amp; p &lt; (datenow + startDayOfMonth - 1)) {
					pegholes.push(document.createElement('div'));
					pegholes[p].classList.add('widthShape', 'filler');
					weekrow1.appendChild(pegholes[p]);
					pegholes[p].style.backgroundColor = 'white';
				}
				if (p >= startDayOfMonth &amp;&amp; p &lt; daysinMonth + startDayOfMonth) {
					pegholes.push(document.createElement('div'));
					pegholes[p].textContent = count;
					pegholes[p].dataset.day = count;
					pegholes[p].dataset.dayofweek = dayofweek;
					pegholes[p].dataset.dayindex = uniqueDayIndex;
					weekrow1.appendChild(pegholes[p]);
					pegholes[p].classList.add('widthShape', 'dayTime');
					//doing
					pegholes[p].id = yearCalc + '-' + monthCalc + '-' + count;
					pegholes[p].addEventListener('click', dateOnClickEvents, false);
					if(p === startDayOfMonth){
						var year = new Date(humandate(pegholes[p].id)).getFullYear();
						pegholes[p].parentElement.parentElement.firstChild.textContent += ' ' + year;
					}
					count++;
					dayofweek++;
					uniqueDayIndex++;
				}
				if (p >= daysinMonth + startDayOfMonth) {
					pegholes.push(document.createElement('div'));
					pegholes[p].classList.add('widthShape', 'filler');
					weekrow1.appendChild(pegholes[p]);
					pegholes[p].style.backgroundColor = 'white';
				}
				if ((p + 1) % 7 === 0) {
					weekrow1 = document.createElement('div');
					months[i].appendChild(weekrow1);
					weekrow1.classList.add('weekrow');
					dayofweek = 0;
				}
			}
			if (i === numberOfMonthsToDisplay - 1) {
				preloadDatesFn(calendar, preloadedDates);
			}
		}
		return this;
	};
}
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	DocStrap Copyright © 2012-2015 The contributors to the JSDoc3 and DocStrap projects.
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a>
	
		on Sat Oct 31st 2020
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
